<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/blog/css/main.css?v=7.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/favicon.ico?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon.ico?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon.ico?v=7.1.1">


  <link rel="mask-icon" href="/blog/images/favicon.ico?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Pisces',
    version: '7.1.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="刘金星个人博客">
<meta name="keywords" content="刘金星, PHP工程师, 个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="刘金星个人博客">
<meta property="og:url" content="https://mylovegy.github.io/blog/index.html">
<meta property="og:site_name" content="刘金星个人博客">
<meta property="og:description" content="刘金星个人博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="刘金星个人博客">
<meta name="twitter:description" content="刘金星个人博客">





  
  
  <link rel="canonical" href="https://mylovegy.github.io/blog/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>刘金星个人博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">刘金星个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">个人博客</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/blog/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/blog/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/blog/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/blog/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/myloveGy" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/10/javascript-vue-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/10/javascript-vue-config/" class="post-title-link" itemprop="url">Vue配置引入自己的包文件</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-10 11:08:55" itemprop="dateCreated datePublished" datetime="2019-05-10T11:08:55+08:00">2019-05-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#vue.config.js中配置编译node_modules中es6的包</p>
<p>因为公司后台项目使用前后端分离的方式，前端使用vue；<br>公司项目比较多，所以在开发过程中，把需要用到的公共 vue 组件和公共代码单独创建了 npm 包，因为我们包里面使用了es6的语法，在我们项目中引入公共包，编译报错，错误原因就是 js 语法报错；<br>找到解决方案，只要配置那个引入的包，也要使用es6的语法去编辑就好！vue.config.js 配置中添加如下如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">dir</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> path.join(__dirname, dir)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	... <span class="comment">// 其他配置</span></span><br><span class="line">	<span class="comment">// 配置你的包也使用 es6 语法解析</span></span><br><span class="line">	chainWebpack: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">		config.module</span><br><span class="line">		  .rule(<span class="string">'compile'</span>)</span><br><span class="line">		  .test(<span class="regexp">/\.js$/</span>)</span><br><span class="line">		  .include</span><br><span class="line">		  .add(resolve(<span class="string">'node_modules/你包的名称'</span>))</span><br><span class="line">		  .end()</span><br><span class="line">		  .use(<span class="string">'babel'</span>).loader(<span class="string">'babel-loader'</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/10/javasctipt-vue-sku/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/10/javasctipt-vue-sku/" class="post-title-link" itemprop="url">Vue实现SKU商品展示</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-10 10:50:57" itemprop="dateCreated datePublished" datetime="2019-05-10T10:50:57+08:00">2019-05-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>由于公司开发了一个电商项目，涉及到前台商品属性的展示，所以百度上找了一下！找到了 周琪力写的一个算法例子,因为作者只有jQuery 实现demo, 自己仿照 demo 实现了一个 vue 的！</p>
<p><a href="http://mp.weixin.qq.com/s?__biz=MzIwNjQwMzUwMQ==&amp;mid=2247484853&amp;idx=1&amp;sn=bed59c1d83c3aeb4bf7881be8dbdd917&amp;chksm=97236777a054ee61fc3cef07eb4b164fa28e26917ce0a409d876964ad3c2ee3f90a000e29beb#rd" target="_blank" rel="noopener">周琪力原文</a><br><a href="http://codepen.io/keelii/pen/RoOzgb" target="_blank" rel="noopener">原文的demo实现</a></p>
<h3 id="vue实现demo展示"><a href="#vue实现demo展示" class="headerlink" title="vue实现demo展示"></a><a href="https://codepen.io/jinxing/pen/qGZBPN" target="_blank" rel="noopener">vue实现demo展示</a></h3><p>效果图：<br> <img src="http://img.blog.csdn.net/20171122102024365?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXlsaXVqeA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>附上代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">	&lt;title&gt;Vue 实现商品属性的计算显示&lt;/title&gt;</span><br><span class="line">	&lt;style&gt;</span><br><span class="line">		body &#123;</span><br><span class="line">            font-size: 12px;</span><br><span class="line">        &#125;</span><br><span class="line">        dt &#123;</span><br><span class="line">            width: 100px;</span><br><span class="line">            text-align: right;</span><br><span class="line">        &#125;</span><br><span class="line">        dl &#123;</span><br><span class="line">            clear: both;</span><br><span class="line">            overflow:hidden;</span><br><span class="line">        &#125;</span><br><span class="line">        dl.hl &#123;</span><br><span class="line">            background:#ddd;</span><br><span class="line">        &#125;</span><br><span class="line">        dt, dd &#123;</span><br><span class="line">            float:left;</span><br><span class="line">            height: 40px;</span><br><span class="line">            line-height: 40px;</span><br><span class="line">            margin-left: 10px;</span><br><span class="line">        &#125;</span><br><span class="line">        button &#123;</span><br><span class="line">            font-size: 14px;</span><br><span class="line">            font-weight: bold;</span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 30px;</span><br><span class="line">            margin: 0 10px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .disabled &#123;</span><br><span class="line">            color:#999;</span><br><span class="line">            border: 1px dashed #666;</span><br><span class="line">        &#125;</span><br><span class="line">        .active &#123;</span><br><span class="line">            color: red;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .top-but &#123;</span><br><span class="line">        	margin: 10px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #skuId &#123;</span><br><span class="line">        	height: 24px;</span><br><span class="line">        	font-size: 14px;</span><br><span class="line">        	line-height: 24px;</span><br><span class="line">        &#125;</span><br><span class="line">	&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;textarea id=&quot;values&quot; style=&quot;width:600px;height:100px&quot;&gt;</span><br><span class="line">		[</span><br><span class="line">		   &#123; &quot;颜色&quot;: &quot;红&quot;, &quot;尺码&quot;: &quot;大&quot;, &quot;型号&quot;: &quot;A&quot;, &quot;skuId&quot;: &quot;3158055&quot; &#125;,</span><br><span class="line">		   &#123; &quot;颜色&quot;: &quot;白&quot;, &quot;尺码&quot;: &quot;大&quot;, &quot;型号&quot;: &quot;A&quot;, &quot;skuId&quot;: &quot;3158054&quot; &#125;,</span><br><span class="line">		   &#123; &quot;颜色&quot;: &quot;白&quot;, &quot;尺码&quot;: &quot;中&quot;, &quot;型号&quot;: &quot;B&quot;, &quot;skuId&quot;: &quot;3133859&quot; &#125;,</span><br><span class="line">		   &#123; &quot;颜色&quot;: &quot;蓝&quot;, &quot;尺码&quot;: &quot;小&quot;, &quot;型号&quot;: &quot;C&quot;, &quot;skuId&quot;: &quot;3516833&quot; &#125;</span><br><span class="line">		]</span><br><span class="line">	&lt;/textarea&gt;</span><br><span class="line">	&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">		&lt;label&gt; </span><br><span class="line">			默认选中 :  </span><br><span class="line">			&lt;input type=&quot;text&quot; name=&quot;skuId&quot; id=&quot;skuId&quot; v-bind:value=&quot;skuId&quot;&gt;</span><br><span class="line">		&lt;/label&gt;</span><br><span class="line">		&lt;button @click=&quot;getTextareaData&quot; class=&quot;top-but&quot;&gt; 重新加载数据 &lt;/button&gt; 当前属性ID：&#123;&#123; skuId &#125;&#125;</span><br><span class="line">		&lt;dl v-for=&quot;item, key in list.result&quot; class=&quot;content&quot; v-bind:class=&quot;&#123;hl: highKeys[key]&#125;&quot;&gt;</span><br><span class="line">			&lt;dt&gt; &#123;&#123;key&#125;&#125; : &lt;/dt&gt; </span><br><span class="line">			&lt;dd&gt;</span><br><span class="line">				&lt;button</span><br><span class="line">					class=&quot;item&quot;</span><br><span class="line">					v-for=&quot;value in item&quot;</span><br><span class="line">					@click=&quot;handleActive(key, value)&quot;</span><br><span class="line">					v-bind:class=&quot;&#123;active: value.active, disabled: !value.active &amp;&amp; value.disabled&#125;&quot; </span><br><span class="line">					&gt; &#123;&#123; value.name &#125;&#125; &lt;/button&gt; </span><br><span class="line">			&lt;/dd&gt;</span><br><span class="line">		&lt;/dl&gt;</span><br><span class="line">		已经选择：&#123;&#123; message &#125;&#125;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script src=&quot;https://unpkg.com/vue &quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	let vue = new Vue(&#123;</span><br><span class="line">		el: &quot;#app&quot;,</span><br><span class="line">		data()&#123;</span><br><span class="line">			return &#123;</span><br><span class="line">				data: [],</span><br><span class="line">				skuId: &quot;&quot;,</span><br><span class="line">				skuName: &quot;skuId&quot;,</span><br><span class="line">				// 属性名称信息</span><br><span class="line">				keys: [],</span><br><span class="line">				// 数据集合&#123;list.result list.items&#125;</span><br><span class="line">				list: &#123;&#125;,</span><br><span class="line">				// 分隔符</span><br><span class="line">				spliter: &apos;\u2299&apos;,</span><br><span class="line">				result: &#123;&#125;,</span><br><span class="line">				message: &quot;&quot;,</span><br><span class="line">				highKeys: &#123;&#125;,</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;,</span><br><span class="line">		methods: &#123;</span><br><span class="line">			powerset(arr) &#123;</span><br><span class="line">			    let ps = [[]];</span><br><span class="line">			    for (let i = 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">			        for (let j = 0, len = ps.length; j &lt; len; j++) &#123;</span><br><span class="line">			            ps.push(ps[j].concat(arr[i]));</span><br><span class="line">			        &#125;</span><br><span class="line">			    &#125;</span><br><span class="line"></span><br><span class="line">			    return ps;</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 初始化数据</span><br><span class="line">			 * @return </span><br><span class="line">			 */</span><br><span class="line">			initData() &#123;</span><br><span class="line">				this.result = &#123;&#125;;</span><br><span class="line">				this.keys = this.getAllKeys();</span><br><span class="line">				for (let i = 0; i &lt; this.keys.length; i ++) &#123;</span><br><span class="line">					this.highKeys[this.keys[i]] = false;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				this.list = this.combineAttr(this.data, this.keys);</span><br><span class="line">				this.initSeleted(this.skuId);</span><br><span class="line">				this.buildResult(this.list.items)</span><br><span class="line">				this.updateStatus(this.getSelectedItem());</span><br><span class="line">				this.showResult();</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 获取输入表单中的数据进行初始化</span><br><span class="line">			 * @return</span><br><span class="line">			 */</span><br><span class="line">			getTextareaData() &#123;</span><br><span class="line">				let data = document.getElementById(&apos;values&apos;).value;</span><br><span class="line">				let skuId = document.getElementById(&quot;skuId&quot;).value;</span><br><span class="line">				</span><br><span class="line">				try &#123;</span><br><span class="line">					this.data = JSON.parse(data);</span><br><span class="line">					let isHas = false;</span><br><span class="line">					for (let i = 0; i &lt; this.data.length; i ++) &#123;</span><br><span class="line">						if (skuId == this.data[i][this.skuName]) &#123;</span><br><span class="line">							isHas = true;</span><br><span class="line">							break</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					this.skuId = isHas ? skuId : this.data[0][this.skuName];</span><br><span class="line">					this.initData();</span><br><span class="line">				&#125; catch (e) &#123;</span><br><span class="line">					this.data = [];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 正常属性点击</span><br><span class="line">			 */</span><br><span class="line">			handleNormalClick(key, value) &#123;</span><br><span class="line">				for (let i in this.list.result[key]) &#123;</span><br><span class="line">					if (i != value.name) &#123;</span><br><span class="line">						this.list.result[key][i].active = false;</span><br><span class="line">					&#125; else &#123;</span><br><span class="line">						this.list.result[key][i].active = true;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 无效属性点击</span><br><span class="line">			 */</span><br><span class="line">			handleDisableClick(key, value) &#123;</span><br><span class="line">				this.list.result[key][value.name][&quot;disabled&quot;] = false;</span><br><span class="line">			    // 清空高亮行的已选属性状态（因为更新的时候默认会跳过已选状态）</span><br><span class="line">			    for (let i in this.list.result) &#123;</span><br><span class="line">			    	if (i != key) &#123;</span><br><span class="line">			    		for (let x in this.list.result[i]) &#123;</span><br><span class="line">			    			this.list.result[i][x].active = false;</span><br><span class="line">			    		&#125;</span><br><span class="line">			    	&#125;</span><br><span class="line">			    &#125;</span><br><span class="line">	</span><br><span class="line">			    this.updateStatus(this.getSelectedItem());</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 高亮行</span><br><span class="line">			 */</span><br><span class="line">			highAttributes: function() &#123;</span><br><span class="line">				for (let key in this.list.result) &#123;</span><br><span class="line">					this.highKeys[key] = true;</span><br><span class="line">					for (let attr in this.list.result[key]) &#123;</span><br><span class="line">						if (this.list.result[key][attr].active === true) &#123;</span><br><span class="line">							this.highKeys[key] = false;</span><br><span class="line">							break;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 点击事件处理</span><br><span class="line">			 * @param  key   点击的行</span><br><span class="line">			 * @param  value 点击的按钮的数据</span><br><span class="line">			 */</span><br><span class="line">			handleActive: function(key, value) &#123;</span><br><span class="line">				if (value.active == true) &#123;</span><br><span class="line">					return false;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">	            this.handleNormalClick(key, value);</span><br><span class="line">	            if (value.disabled === true) &#123;</span><br><span class="line">	                this.handleDisableClick(key, value);</span><br><span class="line">	            &#125;</span><br><span class="line"></span><br><span class="line">	            this.updateStatus(this.getSelectedItem());</span><br><span class="line">	            this.highAttributes();</span><br><span class="line">	            this.showResult();</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 计算属性</span><br><span class="line">			 * @param  &#123;[type]&#125; data [description]</span><br><span class="line">			 * @param  &#123;[type]&#125; keys [description]</span><br><span class="line">			 * @return &#123;[type]&#125;      [description]</span><br><span class="line">			 */</span><br><span class="line">			combineAttr(data, keys) &#123;</span><br><span class="line">			    let allKeys = []</span><br><span class="line">			    let result = &#123;&#125;</span><br><span class="line"></span><br><span class="line">			    for (let i = 0; i &lt; data.length; i++) &#123;</span><br><span class="line">			        let item = data[i]</span><br><span class="line">			        let values = []</span><br><span class="line"></span><br><span class="line">			        for (let j = 0; j &lt; keys.length; j++) &#123;</span><br><span class="line">			            let key = keys[j]</span><br><span class="line">			            if (!result[key]) &#123;</span><br><span class="line">			            	result[key] = &#123;&#125;;</span><br><span class="line">			            &#125;</span><br><span class="line"></span><br><span class="line">			            if (!result[key][item[key]]) &#123;</span><br><span class="line">			            	result[key][item[key]] = &#123;&quot;name&quot;: item[key], &quot;active&quot;: false, &quot;disabled&quot;: true&#125;;</span><br><span class="line">			            &#125;</span><br><span class="line"></span><br><span class="line">			            values.push(item[key]);</span><br><span class="line">			        &#125;</span><br><span class="line"></span><br><span class="line">			        allKeys.push(&#123;</span><br><span class="line">			            path: values.join(this.spliter),</span><br><span class="line">			            sku: item[&apos;skuId&apos;]</span><br><span class="line">			        &#125;);</span><br><span class="line">			    &#125;</span><br><span class="line"></span><br><span class="line">			    return &#123;</span><br><span class="line">			        result: result,</span><br><span class="line">			        items: allKeys</span><br><span class="line">			    &#125;</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 获取所有属性</span><br><span class="line">			 * @return &#123;[type]&#125; [description]</span><br><span class="line">			 */</span><br><span class="line">			getAllKeys() &#123;</span><br><span class="line">				let arrKeys = [];</span><br><span class="line">				for (let attribute in this.data[0]) &#123;</span><br><span class="line">					if (!this.data[0].hasOwnProperty(attribute)) &#123;</span><br><span class="line">						continue;</span><br><span class="line">					&#125; </span><br><span class="line"></span><br><span class="line">					if (attribute !== this.skuName) &#123;</span><br><span class="line">						arrKeys.push(attribute);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				return arrKeys;</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			getAttruites(arr) &#123;</span><br><span class="line">				let result = []</span><br><span class="line">			    for (let i = 0; i &lt; arr.length; i++) &#123; </span><br><span class="line">			    	result.push(arr[i].path) </span><br><span class="line">			    &#125;</span><br><span class="line"></span><br><span class="line">			    return result</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 生成所有子集是否可选、库存状态 map</span><br><span class="line">			 */</span><br><span class="line">			buildResult(items) &#123;</span><br><span class="line">			    let allKeys = this.getAttruites(items)</span><br><span class="line"></span><br><span class="line">			    for (let i = 0; i &lt; allKeys.length; i++) &#123;</span><br><span class="line">			        let curr = allKeys[i];</span><br><span class="line">			        let sku = items[i].sku;</span><br><span class="line">			        let values = curr.split(this.spliter);</span><br><span class="line">			        let allSets = this.powerset(values);</span><br><span class="line"></span><br><span class="line">			        // 每个组合的子集</span><br><span class="line">			        for (let j = 0; j &lt; allSets.length; j++) &#123;</span><br><span class="line">			            let set = allSets[j]</span><br><span class="line">			            let key = set.join(this.spliter)</span><br><span class="line"></span><br><span class="line">			            if (this.result[key]) &#123;</span><br><span class="line">			                this.result[key].skus.push(sku)</span><br><span class="line">			            &#125; else &#123;</span><br><span class="line">			                this.result[key] = &#123;</span><br><span class="line">			                    skus: [sku]</span><br><span class="line">			                &#125;</span><br><span class="line">			            &#125;</span><br><span class="line">			        &#125;</span><br><span class="line">			    &#125;</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 获取选中的信息</span><br><span class="line">			 * @return Array </span><br><span class="line">			 */</span><br><span class="line">			getSelectedItem() &#123;</span><br><span class="line">				let result = [];</span><br><span class="line">				for (let attr in this.list.result) &#123;</span><br><span class="line">					let attributeName = &apos;&apos;;</span><br><span class="line">					for (let attribute in this.list.result[attr]) &#123;</span><br><span class="line">						if (this.list.result[attr][attribute].active === true) &#123;</span><br><span class="line">							attributeName = attribute;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					result.push(attributeName);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			    return result</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 更新所有属性状态</span><br><span class="line">			 */</span><br><span class="line">			updateStatus(selected) &#123;</span><br><span class="line">			    for (let i = 0; i &lt; this.keys.length; i++) &#123;</span><br><span class="line">			        let key = this.keys[i],</span><br><span class="line">			         	data = this.list.result[key],</span><br><span class="line">			        	hasActive = !!selected[i],</span><br><span class="line">			        	copy = selected.slice();</span><br><span class="line"></span><br><span class="line">			        for (let j in data) &#123;</span><br><span class="line">			            let item = data[j][&quot;name&quot;];</span><br><span class="line">			            if (selected[i] == item) &#123;</span><br><span class="line">			            	continue</span><br><span class="line">			            &#125;</span><br><span class="line"></span><br><span class="line">			            copy[i] = item</span><br><span class="line">			            let curr = this.trimSpliter(copy.join(this.spliter), this.spliter);</span><br><span class="line">			            this.list.result[key][j][&quot;disabled&quot;]  = this.result[curr] ? false : true;</span><br><span class="line">			        &#125;</span><br><span class="line">			    &#125;</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			trimSpliter(str, spliter) &#123;</span><br><span class="line">			    // ⊙abc⊙ =&gt; abc</span><br><span class="line">			    // ⊙a⊙⊙b⊙c⊙ =&gt; a⊙b⊙c</span><br><span class="line">			    let reLeft    = new RegExp(&apos;^&apos; + spliter + &apos;+&apos;, &apos;g&apos;);</span><br><span class="line">			    let reRight   = new RegExp(spliter + &apos;+$&apos;, &apos;g&apos;);</span><br><span class="line">			    let reSpliter = new RegExp(spliter + &apos;+&apos;, &apos;g&apos;);</span><br><span class="line">			    return str.replace(reLeft, &apos;&apos;)</span><br><span class="line">			        .replace(reRight, &apos;&apos;)</span><br><span class="line">			        .replace(reSpliter, spliter)</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 初始化选中</span><br><span class="line">			 * @param  mixed|Int|String skuId 需要选中的skuId</span><br><span class="line">			 * @return &#123;[type]&#125;       [description]</span><br><span class="line">			 */</span><br><span class="line">			initSeleted(skuId) &#123;</span><br><span class="line">			    for (let i in this.data) &#123;</span><br><span class="line">			    	if (this.data[i][this.skuName] == skuId) &#123;</span><br><span class="line">			    		for (let x in this.data[i]) &#123;</span><br><span class="line">			    			if (x !== this.skuName) &#123;</span><br><span class="line">			    				this.list.result[x][this.data[i][x]].active = true;</span><br><span class="line">			    			&#125;</span><br><span class="line">			    		&#125;</span><br><span class="line">			    		break;</span><br><span class="line">			    	&#125;</span><br><span class="line">			    &#125;</span><br><span class="line">			&#125;,</span><br><span class="line"></span><br><span class="line">			/**</span><br><span class="line">			 * 显示选中的信息</span><br><span class="line">			 * @return </span><br><span class="line">			 */</span><br><span class="line">			showResult() &#123;</span><br><span class="line">			    let result = this.getSelectedItem()</span><br><span class="line">			    let s = []</span><br><span class="line">			    for (let i = 0; i &lt; result.length; i++) &#123;</span><br><span class="line">			        let item = result[i];</span><br><span class="line">			        if (!!item) &#123;</span><br><span class="line">			            s.push(item)</span><br><span class="line">			        &#125;</span><br><span class="line">			    &#125;</span><br><span class="line"></span><br><span class="line">			    if (s.length == this.keys.length) &#123;</span><br><span class="line">			        let curr = this.result[s.join(this.spliter)]</span><br><span class="line">			        if (curr) &#123;</span><br><span class="line">			            s = s.concat(curr.skus)</span><br><span class="line">			            this.skuId = curr.skus[0];</span><br><span class="line">			        &#125;</span><br><span class="line">			        </span><br><span class="line">			        this.message = s.join(&apos;\u3000-\u3000&apos;);</span><br><span class="line">			    &#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">		created() &#123;</span><br><span class="line">			this.getTextareaData();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/10/php-web-safety/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/10/php-web-safety/" class="post-title-link" itemprop="url">PHP安全Web常见攻击</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-10 10:40:15" itemprop="dateCreated datePublished" datetime="2019-05-10T10:40:15+08:00">2019-05-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><ul>
<li><p>说明<br>攻击者把SQL命令插入到Web表单的输入域或页面请求的字符串，欺骗服务器执行恶意的SQL命令。在某些表单中，用户输入的内容直接用来构造（或者影响）动态SQL命令，或作为存储过程的输入参数，这类表单特别容易受到SQL注入式攻击</p>
</li>
<li><p>模拟</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// SQL</span><br><span class="line">$query = &apos;SELECT * FROM `user` WHERE `username` = &apos; . $username . &apos; AND `password` = &apos;. $password;</span><br><span class="line">// 在没有过滤下 如果 $username 或者 $password 为 &apos;1&apos; OR 1 = 1 ,那么SQL 为</span><br><span class="line">// &quot;SELECT * FROM `user` WHERE `username` = &apos;1&apos; OR 1 = 1 AND `password` = &apos;1&apos; OR 1 = 1&quot;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>危害</p>
<ul>
<li>查询数据库中敏感数据</li>
<li>绕过认证</li>
<li>添加、删除、修改服务器数据</li>
<li>拒绝服务</li>
</ul>
</li>
<li><p>防范</p>
<ul>
<li>检查变量的数据类型和格式</li>
<li>过滤特殊符号</li>
<li>SQL组装的时候，对外部变量以及所有变量都进行过滤</li>
<li>可以用sqlEscape、sqlImplode、sqlSingle、sqlMulti等函数过滤组装。过滤主要是一些’单引号这些可以破坏SQL组装的数据</li>
<li>绑定变量,使用预处理语句</li>
</ul>
</li>
</ul>
<h1 id="跨站脚本攻击"><a href="#跨站脚本攻击" class="headerlink" title="跨站脚本攻击"></a>跨站脚本攻击</h1><ul>
<li><p>说明</p>
<p>  XSS跨站脚本;恶意攻击者往Web页面里插入恶意html代码，当用户浏览该页之时，嵌入其中Web里面的html代码会被执行，从而达到恶意用户的特殊目的.反射型跨站。GET或POST内容未过滤，可以提交js以及HTML等恶意代码。</p>
</li>
<li><p>模拟</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php echo $_GET[&apos;message&apos;] ?&gt;</span><br><span class="line">// 正常url</span><br><span class="line">index.php?message=处理成功</span><br><span class="line">// 带js的url</span><br><span class="line">index.php?message=&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">// 恶意跳转url</span><br><span class="line">index.php?message=&lt;script&gt;window.location.href=user.php&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>危害</p>
<ul>
<li>获取到用户cookie信息</li>
<li>跳转到钓鱼网站</li>
<li>操作受害者的浏览器，查看受害者网页浏览信息等。</li>
<li>蠕虫攻击。</li>
</ul>
</li>
<li>防范<ul>
<li>使用htmlspecialchars函数将特殊字符转换成HTML编码，过滤输出的变量</li>
</ul>
</li>
</ul>
<h1 id="跨站请求伪造"><a href="#跨站请求伪造" class="headerlink" title="跨站请求伪造"></a>跨站请求伪造</h1><ul>
<li><p>说明</p>
<p>  CSRF跨站请求伪造，也被称成为“one click attack”或者session riding，通常缩写为CSRF或者XSRF，是一种对网站的恶意利用。XSS利用站点内的信任用户，而CSRF则通过伪装来自受信任用户的请求来利用受信任的网站。与XSS攻击相比，CSRF攻击往往不大流行（因此对其进行防范的资源也相当稀少）和难以防范，所以被认为比XSS更具危险性。</p>
</li>
<li><p>模拟</p>
<p>  某个购物网站购买商品时，采用<a href="http://www.shop.com/buy.php?item=watch&amp;num=100，item参数确定要购买什么物品，num参数确定要购买数量，如果攻击者以隐藏的方式发送给目标用户链接" target="_blank" rel="noopener">http://www.shop.com/buy.php?item=watch&amp;num=100，item参数确定要购买什么物品，num参数确定要购买数量，如果攻击者以隐藏的方式发送给目标用户链接</a><br>，那么如果目标用户不小心访问以后，购买的数量就成了100个</p>
</li>
<li><p>危害</p>
<ul>
<li>强迫受害者的浏览器向一个易受攻击的Web应用程序发送请求,最后达到攻击者所需要的操作行为</li>
</ul>
</li>
<li><p>防范</p>
<ul>
<li>检查网页来源</li>
<li>检查内置的隐藏变量</li>
<li>使用POST，不要使用GET，处理变量也不要直接使用$_REQUEST</li>
<li>采用类似随即码或者令牌的形式，让用户操作唯一性。 （每次用户登录网站随机生成一token，存放在cookie中，用户的所有操作中都需要经过token验证）</li>
</ul>
</li>
</ul>
<h1 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h1><ul>
<li><p>说明</p>
<p>  攻击者利用程序缺陷绕过系统对文件的验证与处理策略将恶意代码上传到服务器并获得执行服务器端命令的能力。</p>
</li>
<li><p>常用的攻击手段有</p>
<ul>
<li>上传Flash跨域策略文件crossdomain.xml，修改访问权限(其他策略文件利用方式类似)；</li>
<li>上传病毒、木马文件，诱骗用户和管理员下载执行；</li>
<li>上传包含脚本的图片，某些浏览器的低级版本会执行该脚本，用于钓鱼和欺诈。</li>
<li>总的来说，利用的上传文件要么具备可执行能力(恶意代码)，要么具备影响服务器行为的能力(配置文件)。</li>
<li>上传Web脚本代码，Web容器解释执行上传的恶意脚本</li>
</ul>
</li>
<li><p>防范</p>
<ul>
<li>文件上传的目录设置为不可执行</li>
<li>判断文件类型，设置白名单。对于图片的处理，可以使用压缩函数或者resize函数，在处理图片的同时破坏图片中可能包含的HTML代码</li>
<li>使用随机数改写文件名和文件路径：一个是上传后无法访问；再来就是像shell、.php 、.rar和crossdomain.xml这种文件，都将因为重命名而无法攻击</li>
<li>单独设置文件服务器的域名：由于浏览器同源策略的关系，一系列客户端攻击将失效，比如上传crossdomain.xml、上传包含Javascript的XSS利用等问题将得到解决</li>
</ul>
</li>
</ul>
<h1 id="SESSION-劫持"><a href="#SESSION-劫持" class="headerlink" title="SESSION 劫持"></a>SESSION 劫持</h1><ul>
<li><p>说明</p>
<p>  攻击者利用各种手段来获取目标用户的session id。一旦获取到session id，那么攻击者可以利用目标用户的身份来登录网站，获取目标用户的操作权限</p>
</li>
<li>攻击者获取目标用户session id的方法<ul>
<li>暴力破解:尝试各种session id，直到破解为止;</li>
<li>计算:如果session id使用非随机的方式产生，那么就有可能计算出来;</li>
<li>窃取:使用网络截获，xss攻击等方法获得</li>
</ul>
</li>
<li><p>防范</p>
<ul>
<li>定期更改session id</li>
<li>更改session的名称</li>
<li>关闭透明化session id</li>
<li>设置HttpOnly。通过设置Cookie的HttpOnly为true，可以防止客户端脚本访问这个Cookie，从而有效的防止XSS攻击</li>
</ul>
</li>
</ul>
<h1 id="其他安全相关"><a href="#其他安全相关" class="headerlink" title="其他安全相关"></a>其他安全相关</h1><ol>
<li><p>X-Frame-Options防止网页放在iframe中</p>
<p> X-Frame-Options是一个HTTP标头（header），用来告诉浏览器这个网页是否可以放在iFrame内</p>
<p> X-Frame-Options 有三个可选的值</p>
<ul>
<li>DENY：浏览器拒绝当前页面加载任何Frame页面</li>
<li>SAMEORIGIN：frame页面的地址只能为同源域名下的页面</li>
<li><p>ALLOW-FROM：origin为允许frame加载的页面地址</p>
<p>可以直接通过meta标签来设置，不需要放在http头部请求中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;X-Frame-Options&quot; content=&quot;ALLOW-FROM http://optimizely.com&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h4><ol>
<li><a href="http://blog.csdn.net/erjian666/article/details/53289763" target="_blank" rel="noopener">参考一</a></li>
<li><a href="http://www.cnblogs.com/luyucheng/p/6234524.html" target="_blank" rel="noopener">参考二</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/10/php-yii2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/10/php-yii2/" class="post-title-link" itemprop="url">Yii2学习笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-10 10:37:42" itemprop="dateCreated datePublished" datetime="2019-05-10T10:37:42+08:00">2019-05-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h1><h2 id="控制器周期"><a href="#控制器周期" class="headerlink" title="控制器周期"></a>控制器周期</h2><h3 id="beforeAction"><a href="#beforeAction" class="headerlink" title="beforeAction"></a>beforeAction</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * action 运行的前置操作 </span><br><span class="line"> *</span><br><span class="line"> * 比较适合统一化的数据验证，请求数据的接受等</span><br><span class="line"> * @param \yii\base\Action $action action 类</span><br><span class="line"> * @return bool 返回ture 控制器周期才会走下去</span><br><span class="line"> */</span><br><span class="line">public function beforeAction($action)</span><br><span class="line">&#123;</span><br><span class="line">    var_dump($action-&gt;id, $action-&gt;controller-&gt;id);</span><br><span class="line">    return parent::beforeAction($action); // TODO: Change the autogenerated stub</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="afterAction"><a href="#afterAction" class="headerlink" title="afterAction"></a>afterAction</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * action 后置操作</span><br><span class="line"> *</span><br><span class="line"> * 比较适合返回最后的日志搜集</span><br><span class="line"> * @param \yii\base\Action $action action 类</span><br><span class="line"> * @param mixed $result</span><br><span class="line"> * @return mixed</span><br><span class="line"> */</span><br><span class="line">public function afterAction($action, $result)</span><br><span class="line">&#123;</span><br><span class="line">    return parent::afterAction($action, $result); // TODO: Change the autogenerated stub</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h1><h2 id="AR-模型-常用方法"><a href="#AR-模型-常用方法" class="headerlink" title="AR 模型 常用方法"></a>AR 模型 常用方法</h2><h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 查询单条</span><br><span class="line">$one = Post::find()-&gt;where([&apos;id&apos; =&gt; 1])-&gt;one();</span><br><span class="line">// 或者</span><br><span class="line">$one = Post::finOne(1);</span><br><span class="line"></span><br><span class="line">// 查询多条</span><br><span class="line">$posts = Post::find()-&gt;where([&apos;status&apos; =&gt; 1])-&gt;all();</span><br><span class="line">// 或者</span><br><span class="line">$posts = Post::findAll([&apos;status&apos; =&gt; 1]);</span><br><span class="line"></span><br><span class="line">// 通过sql查询</span><br><span class="line">$posts = Post::findBySql(&apos;SELECT * FROM `posts` WHERE `status` = :status&apos;, [&apos;:status&apos; =&gt; 1])-&gt;all();</span><br></pre></td></tr></table></figure>
<h3 id="查询条件的设定"><a href="#查询条件的设定" class="headerlink" title="查询条件的设定"></a>查询条件的设定</h3><h4 id="where-查询支持的参数"><a href="#where-查询支持的参数" class="headerlink" title="where 查询支持的参数"></a>where 查询支持的参数</h4><ul>
<li><p>字符串格式 例如: ‘status=1’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 对应的SQL: WHERE status = 1</span><br><span class="line">$query-&gt;where(&apos;status = 1&apos;);</span><br><span class="line">// 使用字符串方式,可以绑定参数</span><br><span class="line">$query-&gt;where(&apos;status = :status&apos;, [&apos;:status&apos; =&gt; 1])</span><br></pre></td></tr></table></figure>
</li>
<li><p>哈希格式 例如: [‘status’ =&gt; 1, ‘type’ =&gt; 1]</p>
</li>
</ul>
<p>哈希格式最适合用来指定多个 AND 串联起来的简单的”等于断言”子条件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 对应的SQL: WHERE (`status`=1) AND (`type`=1)</span><br><span class="line">$query-&gt;where([&apos;status&apos; =&gt; 1, &apos;type&apos; =&gt; 1])</span><br><span class="line">// 如果值为一个数组会转为IN 对应SQL: WHERE (`status`=1) AND (`type` IN (1, 2, 3))</span><br><span class="line">$query-&gt;where([&apos;status&apos; =&gt; 1, &apos;type&apos; =&gt; [1, 2, 3]])</span><br></pre></td></tr></table></figure></p>
<ul>
<li>操作符格式 例如:  [‘=’, ‘status’, 1]</li>
</ul>
<p>可以实现比较复杂的查询条件</p>
<ol>
<li><p>格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&apos;操作符&apos;, 操作数1, 操作数2, ...];</span><br></pre></td></tr></table></figure>
</li>
<li><p>演示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 简单单个查询 对应的SQL: WHERE `status` &gt;= 1</span><br><span class="line">$query-&gt;where([&apos;&gt;=&apos;, &apos;status&apos;, 1])</span><br><span class="line"></span><br><span class="line">// 多个条件 AND 连接 对应的SQL: WHERE (`status` &gt;= 1) AND (`type` &lt;= 3)</span><br><span class="line">$query-&gt;where([&apos;and&apos;, [&apos;&gt;=&apos;, &apos;status&apos;, 1], [&apos;&lt;=&apos;, &apos;type&apos;, 3]])</span><br><span class="line"></span><br><span class="line">// 多个条件 OR 连接 对应SQL: WHERE (`status` IN (1, 3)) OR (`type` &gt;= 2)</span><br><span class="line">$query-&gt;where(&apos;or&apos;, [&apos;in&apos;, &apos;status&apos;, [1, 3], [&apos;&gt;=&apos;, &apos;type&apos;, 2]])</span><br><span class="line"></span><br><span class="line">// 比较复杂组合的SQL 对应SQL: WHERE (`create_type` = 6) AND (`status` = 0) AND (`is_fail` = 0) AND (((`last_view_time` = 0) AND (`create_time` &lt;= 1503562511)) OR ((`last_view_time` &gt; 0) AND (`last_view_time` &lt;= 1503562511)))</span><br><span class="line">$query-&gt;where([</span><br><span class="line">     &apos;and&apos;,</span><br><span class="line">    [&apos;=&apos;, &apos;create_type&apos;, 6],</span><br><span class="line">    [&apos;=&apos;, &apos;status&apos;, 0],</span><br><span class="line">    [&apos;=&apos;, &apos;is_fail&apos;, 0],</span><br><span class="line">    [&apos;or&apos;,</span><br><span class="line">        [&apos;and&apos;, [&apos;=&apos;, &apos;last_view_time&apos;, 0], [&apos;&lt;=&apos;, &apos;create_time&apos;, time()]],</span><br><span class="line">        [&apos;and&apos;, [&apos;&gt;&apos;, &apos;last_view_time&apos;, 0], [&apos;&lt;=&apos;, &apos;last_view_time&apos;, time()]]</span><br><span class="line">    ]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>操作符说明</p>
<ul>
<li>and 和 or 确定多个条件通过什么方式连接</li>
<li><p>between 和 not between</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 数组需要四个元素 对应SQL: WHERE `id` BETWEEN 1 AND 10</span><br><span class="line">[&apos;between&apos;, &apos;id&apos;, 1, 10]</span><br></pre></td></tr></table></figure>
</li>
<li><p>in 和 not in </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 对应SQL: WHERE `status` IN (1, 3)</span><br><span class="line">[&apos;in&apos;, &apos;status&apos;, [1, 3]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>like</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 默认 对应SQL: WHERE `name` LIKE &apos;%username%&apos;</span><br><span class="line">[&apos;like&apos;, &apos;name&apos;, &apos;username&apos;] </span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 第二个范围值是一个数组，那么将会生成用 AND 串联起来的 多个 like 语句</span><br><span class="line"> * 对应SQL: WHERE `name` LIKE &apos;%user%&apos; AND `name` LIKE &apos;%name%&apos;</span><br><span class="line"> */</span><br><span class="line">[&apos;like&apos;, &apos;name&apos;, [&apos;user&apos;, &apos;name&apos;]]</span><br><span class="line"></span><br><span class="line">// 使用前缀查询 对应SQL: WHERE `name` LIKE &apos;user%&apos;</span><br><span class="line">[&apos;like&apos;, &apos;name&apos;, &apos;user%&apos;, false]</span><br></pre></td></tr></table></figure>
</li>
<li><p>or like 与like 相同,只是第二个范围值是一个数组，那么将会生成用 OR 串联起来的 多个 like 语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 对应的SQL: WHERE `name` LIKE &apos;%user%&apos; OR `name` LIKE &apos;%name%&apos;</span><br><span class="line">[&apos;or like&apos;, &apos;name&apos;, [&apos;user&apos;, &apos;name&apos;]]</span><br><span class="line"></span><br><span class="line">// 自己定义前缀查询还是后缀查询 对应SQL: WHERE `name` LIKE &apos;user%&apos; OR `name` LIKE &apos;%name&apos;</span><br><span class="line">[&apos;or like&apos;, &apos;name&apos;, [&apos;user%&apos;, &apos;%name&apos;], false]</span><br></pre></td></tr></table></figure>
</li>
<li><p>not like 和 or not like 和 like 与 or like 用法相同</p>
</li>
<li>exists 和 not exists 需要一个操作数，该操作数必须是代表子查询 yii\db\Query 的一个实例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 生成的SQL: WHERE EXISTS (SELECT * FROM `user` WHERE `status` = 1)</span><br><span class="line">$queryOne = new Query();</span><br><span class="line">$queryOne-&gt;from(&apos;user&apos;)-&gt;where([&apos;=&apos;, &apos;status&apos;, 1])-&gt;one();</span><br><span class="line">$query-&gt;where([&apos;exists&apos;, $queryOne])</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<pre><code>- \&gt;, &gt;=, =, &lt;, &lt;=
</code></pre><ul>
<li><p>andWhere 和 orWhere 在原有条件的基础上 附加额外的条件。你可以多次调用这些方法来分别追加不同的条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 对应SQL: WHERE (`status` = 1) AND (`type` &gt;= 1)</span><br><span class="line">$query-&gt;where([&apos;=&apos;, &apos;status&apos;, 1]);</span><br><span class="line">$query-&gt;andWhere([&apos;&gt;=&apos;, &apos;type&apos;, 1]);</span><br><span class="line"></span><br><span class="line">// 对应的SQL: WHERE ((`status`=1) AND (`type`=1)) OR (`name`=&apos;username&apos;)</span><br><span class="line">$query-&gt;where([&apos;status&apos; =&gt; 1, &apos;type&apos; =&gt; 1]);</span><br><span class="line">$query-&gt;orWhere([&apos;name&apos; =&gt; &apos;username&apos;]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>filterWhere 过滤查询(在用户输入查询的时候比较好用) 会忽略空值(null, ‘’, ‘ ‘, [])</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 不会添加查询条件</span><br><span class="line">$status = &apos;&apos;; // null, &apos; &apos;, [] 都不会添加查询条件</span><br><span class="line">$query-&gt;filterWhere([&apos;status&apos; =&gt;  $status]);</span><br><span class="line"></span><br><span class="line">// 添加查询条件: WHERE `status` = 0</span><br><span class="line">$status = 0;</span><br><span class="line">$query-&gt;filterWhere([&apos;status&apos; =&gt; $status]);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="建议查询时候直接使用where-方法中传递数组的方式定义where条件-andWhere-和-orWhere-会增加判断"><a href="#建议查询时候直接使用where-方法中传递数组的方式定义where条件-andWhere-和-orWhere-会增加判断" class="headerlink" title="建议查询时候直接使用where() 方法中传递数组的方式定义where条件; andWhere() 和 orWhere() 会增加判断"></a>建议查询时候直接使用where() 方法中传递数组的方式定义where条件; andWhere() 和 orWhere() 会增加判断</h4><h3 id="查询对象转数组"><a href="#查询对象转数组" class="headerlink" title="查询对象转数组"></a>查询对象转数组</h3><p>asArray() 方法</p>
<p>在对查询数据没有其他操作的情况下,建议都转为数组(能够节省内存)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 查询出来是一个数组</span><br><span class="line">$posts = Post::find()-&gt;where([&apos;status&apos; =&gt; 1])-&gt;asArray()-&gt;all();</span><br></pre></td></tr></table></figure>
<h3 id="指定数组的键"><a href="#指定数组的键" class="headerlink" title="指定数组的键"></a>指定数组的键</h3><p>indexBy() 方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$users = User::find()-&gt;where([&apos;status&apos; =&gt; 1])-&gt;asArray()-&gt;indexBy(&apos;id&apos;)-&gt;all();</span><br><span class="line"></span><br><span class="line">// 查询出来的数组</span><br><span class="line">[</span><br><span class="line">    &apos;1&apos; =&gt; [</span><br><span class="line">        &apos;id&apos; =&gt; 1,</span><br><span class="line">        &apos;status&apos; =&gt; 1,</span><br><span class="line">        &apos;username&apos; =&gt; &apos;username&apos;</span><br><span class="line">    ],</span><br><span class="line">    &apos;3&apos; =&gt; [</span><br><span class="line">        &apos;id&apos; =&gt; 3,</span><br><span class="line">        &apos;status&apos; =&gt; 1,</span><br><span class="line">        &apos;username&apos; =&gt; &apos;my name&apos;</span><br><span class="line">    ],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">// 这样查询出来的数组，判断指定ID的用户是否存在比较方法(特别是循环中)</span><br><span class="line">if (isset($user[1])) &#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><p>现在后台程序需要显示文章信息,并且需要显示文章的作者信息</p>
<p>两个表的结构</p>
<p>文章表 article<br>字段名 | 字段说明<br>—|—<br>id | 文章ID<br>user_id | 文章作者ID<br>title | 文章标题</p>
<p>用户表 user</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>字段说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>用户ID</td>
</tr>
<tr>
<td>name</td>
<td>用户姓名</td>
</tr>
</tbody>
</table>
<ul>
<li><p>方案一 使用表关联</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// Article 模型类中定义关联关系</span><br><span class="line">class Article extends ActiveRecord</span><br><span class="line">&#123;</span><br><span class="line">    public function getUser()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;hasOne(User::className(), [&apos;id&apos; =&gt; &apos;user_id&apos;]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 使用</span><br><span class="line"> *</span><br><span class="line"> * 说明这里也是只使用了两次查询</span><br><span class="line"> * 第一次: SELECT * FROM `article` LIMIT 10</span><br><span class="line"> * 第二次: SELECT * FROM `user` WHERE `id` IN (1, 2, ...)</span><br><span class="line"> */</span><br><span class="line">$arrArticles = Article::find()-&gt;with(&apos;user&apos;)-&gt;limit(10)-&gt;asArray()-&gt;all();</span><br><span class="line">if ($arrArticles) &#123;</span><br><span class="line">    foreach ($arrArticles as $article) &#123;</span><br><span class="line">        if (isset($article[&apos;user&apos;])) &#123;</span><br><span class="line">            // 使用作者名称</span><br><span class="line">            $article[&apos;user&apos;][&apos;name&apos;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方案二 使用indexBy()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 第一步查询出文章信息</span><br><span class="line">$arrArticles = Article::find()-&gt;limit(10)-&gt;asArray()-&gt;all();</span><br><span class="line"></span><br><span class="line">// 第二步获取到用户信息</span><br><span class="line">if ($arrArticles) &#123;</span><br><span class="line">    // 获取到用户ID </span><br><span class="line">    $arrUserIds = array_column($arrArticles, &apos;user_id&apos;);</span><br><span class="line">    // 查询到客户信息</span><br><span class="line">    $arrUsers = User::find()-&gt;where([&apos;id&apos; =&gt; $arrUserIds])-&gt;indexBy(&apos;id&apos;)-&gt;asArray()-&gt;all();</span><br><span class="line">    // 三 将用户名称追加到文章信息中</span><br><span class="line">    foreach ($arrArticles as &amp;$value) &#123;</span><br><span class="line">        $value[&apos;user_name&apos;] = &apos;&apos;;</span><br><span class="line">        if (isset($arrUsers[$value[&apos;user_id&apos;]])) &#123;</span><br><span class="line">            $value[&apos;user_name&apos;] = $arrUsers[$value[&apos;user_id&apos;]][&apos;name&apos;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="批处理查询"><a href="#批处理查询" class="headerlink" title="批处理查询"></a>批处理查询</h3><p>当需要处理大数据的时候，像 yii\db\Query::all() 这样的方法就不太合适了， 因为它们会把所有数据都读取到内存上。为了保持较低的内存需求， Yii 提供了一个 所谓的批处理查询的支持。批处理查询会利用数据游标 将数据以批为单位取出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">use yii\db\Query;</span><br><span class="line"></span><br><span class="line">$query = (new Query())</span><br><span class="line">    -&gt;from(&apos;user&apos;)</span><br><span class="line">    -&gt;orderBy(&apos;id&apos;);</span><br><span class="line"></span><br><span class="line">foreach ($query-&gt;batch() as $users) &#123;</span><br><span class="line">    // $users 是一个包含100条或小于100条用户表数据的数组</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// or if you want to iterate the row one by one</span><br><span class="line">foreach ($query-&gt;each() as $user) &#123;</span><br><span class="line">    // $user 指代的是用户表当中的其中一行数据</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>yii\db\Query::batch() 和 yii\db\Query::each() 方法将会返回一个实现了Iterator 接口 yii\db\BatchQueryResult 的对象，可以用在 foreach 结构当中使用。在第一次迭代取数据的时候， 数据库会执行一次 SQL 查询，然后在剩下的迭代中，将直接从结果集中批量获取数据。默认情况下， 一批的大小为 100，也就意味着一批获取的数据是 100 行。你可以通过给 batch() 或者 each() 方法的第一个参数传值来改变每批行数的大小。</p>
<h3 id="查看执行语句"><a href="#查看执行语句" class="headerlink" title="查看执行语句"></a>查看执行语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 可以通过yii 自带的 debug 工具查看</span><br><span class="line"></span><br><span class="line">// 通过model 类</span><br><span class="line">// 查看执行SQL: SELECT * FROM `user` WHERE `status` IN (1, 2)</span><br><span class="line">var_dump(User::find()-&gt;where([&apos;status&apos; =&gt; [1, 2, 3]])-&gt;createCommand()-&gt;getRawSql());</span><br><span class="line"></span><br><span class="line">// 查看预处理的SQL: SELECT * FROM `user` WHERE `status` IN (:qp0, :qp1)</span><br><span class="line">var_dump(User::find()-&gt;where([&apos;status&apos; =&gt; [1, 2, 3]])-&gt;createCommand()-&gt;getSql());</span><br></pre></td></tr></table></figure>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><h3 id="验证规则定义"><a href="#验证规则定义" class="headerlink" title="验证规则定义"></a>验证规则定义</h3><p>定义格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 第一个字段可以为字符串,也可以是数组</span><br><span class="line">[[验证字段], 验证规则, 其他配置项...]</span><br><span class="line"></span><br><span class="line">// 为字符串的时候必须为单个字段</span><br><span class="line">[&apos;username&apos;, &apos;required&apos;, &apos;message&apos; =&gt; &apos;用户名不能为空&apos;]</span><br><span class="line"></span><br><span class="line">// 多个字段验证</span><br><span class="line">[[&apos;username&apos;, &apos;password&apos;], &apos;required&apos;]</span><br></pre></td></tr></table></figure></p>
<p>例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 在模型的 rules 方法中定义</span><br><span class="line">public function rules()</span><br><span class="line">&#123;</span><br><span class="line">    return [</span><br><span class="line">        // 不能为空</span><br><span class="line">        [[&apos;username&apos;, &apos;passwrod&apos;], &apos;required&apos;],</span><br><span class="line">        // 必须唯一</span><br><span class="line">        [[&apos;username&apos;], &apos;unique&apos;],</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="验证规则类型"><a href="#验证规则类型" class="headerlink" title="验证规则类型"></a>验证规则类型</h3><p>说明<br>一般提示信息可以不用填写,会自动匹配 attributeLabels() 方法返回的字段说明信息</p>
<ul>
<li><p>required: 必须值验证 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// requiredValue, message 可以不用填写</span><br><span class="line">[[&apos;字段名&apos;], &apos;required&apos;, &apos;requiredValue&apos; =&gt; &apos;必填值&apos;, &apos;message&apos; =&gt; &apos;提示信息&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>email 邮箱格式验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&apos;email&apos;, &apos;email&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>match 正则表达事验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[&apos;字段名&apos;], &apos;match&apos;, &apos;pattern&apos; =&gt; &apos;正则表达式&apos;]</span><br><span class="line">// 正则取反</span><br><span class="line">[[&apos;字段名&apos;], &apos;match&apos;, &apos;pattern&apos; =&gt; &apos;正则表达式&apos;, &apos;not&apos; =&gt; true]</span><br></pre></td></tr></table></figure>
</li>
<li><p>url 网址信息验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 验证https 或者 http 的网址</span><br><span class="line">[&apos;字段名&apos;, &apos;url&apos;]</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 输入字段可以不带 http 前缀,默认帮你添加</span><br><span class="line"> * 输入的值可以是 www.baidu.com 也可以是 http://www.baidu.com</span><br><span class="line"> * 输入 www.baidu.com 会帮你加上 http:// 最终为 http://www.baidu.com</span><br><span class="line"> */</span><br><span class="line">[[&apos;字段名&apos;], &apos;url&apos;, &apos;defaultScheme&apos; =&gt; &apos;http&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>captcha 验证码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&apos;验证码字段&apos;, &apos;captcha&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>compare 比较</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// compareValue 比较值 operator 比较类型</span><br><span class="line">[&apos;字段&apos;, &apos;compare&apos;, &apos;compareValue&apos; =&gt; 30, &apos;operator&apos; =&gt; &apos;&gt;=&apos;]</span><br><span class="line"></span><br><span class="line">// 比较两个字段的值(确认密码需要与密码一致)</span><br><span class="line">[[&apos;confirm_password&apos;], &apos;compare&apos;, &apos;compareAttribute&apos; =&gt; &apos;password&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>default 默认值 当字段为空那么赋默认值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// value 定义默认值</span><br><span class="line">[&apos;字段&apos;, &apos;default&apos;, &apos;value&apos; =&gt; 30]</span><br></pre></td></tr></table></figure>
</li>
<li><p>exist 验证存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 验证数据username 在表中必须存在</span><br><span class="line">[&apos;username&apos;, &apos;exist&apos;]</span><br><span class="line"></span><br><span class="line">// 定义查询的model, 用户名在admin 表中是否存在</span><br><span class="line">[&apos;username&apos;, &apos;exist&apos;, &apos;targetClass&apos; =&gt; Admin::className()]</span><br><span class="line"></span><br><span class="line">// 定义数据的字段</span><br><span class="line">[&apos;username&apos;, &apos;exist&apos;, &apos;targetAttribute&apos; =&gt; &apos;name&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>unique 唯一性验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * targetClass 可以配置查询那个表</span><br><span class="line"> * targetAttribute 可以定义对应的字段信息</span><br><span class="line"> */</span><br><span class="line">[&apos;username&apos;, &apos;unique&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>file 文件验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * extension 允许上传的文件类型</span><br><span class="line"> * 其他配置项</span><br><span class="line"> * checkExtensionByMimeType 是否使用mime类型检查文件类型（扩展名）</span><br><span class="line"> * mimeTypes 允许的mimeTypes 类型</span><br><span class="line"> * minSize 文件最小大小</span><br><span class="line"> * maxSize 文件最大大小</span><br><span class="line"> * 其他配置...</span><br><span class="line"> */</span><br><span class="line">[[&apos;file&apos;], &apos;file&apos;, &apos;extensions&apos; =&gt; [&apos;png&apos;, &apos;jpg&apos;, &apos;gif&apos;, &apos;jpeg&apos;]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>image 图片验证 继承于 File</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * image 验证继承于 file 验证</span><br><span class="line"> * file 定义的验证配置都可以使用</span><br><span class="line"> * 其他配置</span><br><span class="line"> * minWidth, minHeight, maxWidth, maxLength, ...</span><br><span class="line"> */</span><br><span class="line">[&apos;image&apos;, &apos;image&apos;, &apos;minWidth&apos; =&gt; 100]</span><br></pre></td></tr></table></figure>
</li>
<li><p>filter 滤镜[trim]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * filter 制定过滤的函数 可以使用匿名函数</span><br><span class="line"> * skipOnArray 是否跳过数组过滤</span><br><span class="line"> */</span><br><span class="line">[&apos;username&apos;, &apos;filter&apos;, &apos;filter&apos; =&gt; &apos;trim&apos;, &apos;skipOnArray&apos; =&gt; true]</span><br></pre></td></tr></table></figure>
</li>
<li><p>trim 处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[&apos;username&apos;, &apos;password&apos;], &apos;trim&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>in 范围值验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// range 定义范围值</span><br><span class="line">[&apos;status&apos;, &apos;in&apos;, &apos;range&apos; =&gt; [1, 2]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>integer 整数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&apos;age&apos;, &apos;integer&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>number 数字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&apos;money&apos;, &apos;number&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>double 浮点数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&apos;money&apos;, &apos;double&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>string 字符串验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * length 定义字符串最小长度和最大长度</span><br><span class="line"> * min, max 单独定义指定最小,最大长度</span><br><span class="line"> */</span><br><span class="line">[&apos;title&apos;, &apos;string&apos;, &apos;length&apos; =&gt; [1, 2]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>boolean 布尔值验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * strict 定义是否严格验证</span><br><span class="line"> */</span><br><span class="line">[&apos;字段名&apos;, &apos;boolean&apos;, &apos;trueValue&apos; =&gt; true, &apos;falseValue&apos; =&gt; false, &apos;strict&apos; =&gt; true]</span><br></pre></td></tr></table></figure>
</li>
<li><p>date 日期验证[data, time, datetime]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&apos;start_time&apos;, &apos;date&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>ip 验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[&apos;user_ip&apos;], &apos;ip&apos;]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="自定义验证规则"><a href="#自定义验证规则" class="headerlink" title="自定义验证规则"></a>自定义验证规则</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class User extends Model</span><br><span class="line">&#123;</span><br><span class="line">    public function rules()</span><br><span class="line">    &#123;</span><br><span class="line">        return [</span><br><span class="line">            [&apos;username&apos;, &apos;validateUser&apos;, &apos;params&apos; =&gt; [1, 2, 3]]</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 自定义验证处理</span><br><span class="line">     *</span><br><span class="line">     * @desc 函数写的时候可以不接受参数</span><br><span class="line">     * @param string $attribute 字段名称</span><br><span class="line">     * @param mixed $params rules 中定义的params 参数信息</span><br><span class="line">     * @param \yii\validators\InlineValidator $validator 验证类</span><br><span class="line">     */</span><br><span class="line">    public function validateUser($attribute, $params, $validator)</span><br><span class="line">    &#123;</span><br><span class="line">        if ($this-&gt;user == 2) &#123;</span><br><span class="line">            $this-&gt;addError($attribute, &apos;不能等于二&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="验证规则生效条件"><a href="#验证规则生效条件" class="headerlink" title="验证规则生效条件"></a>验证规则生效条件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 可以定义指定验证的生效条件</span><br><span class="line">[</span><br><span class="line">    [&apos;passowrd&apos;], </span><br><span class="line">    &apos;required&apos;, </span><br><span class="line">    </span><br><span class="line">    // 指定服务器验证什么时候生效(当状态为1的时候密码不能为空)</span><br><span class="line">    &apos;when&apos; =&gt; function ($model) &#123;</span><br><span class="line">        return $model-&gt;status == 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    // 前端js 验证什么时候生效</span><br><span class="line">    &apos;whenClient&apos; =&gt; &quot;function(attribute, value) &#123;</span><br><span class="line">        return $(&apos;#status&apos;).val() == 1;</span><br><span class="line">    &#125;&quot;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h3 id="验证场景"><a href="#验证场景" class="headerlink" title="验证场景"></a>验证场景</h3><p>model 可能在不同的场景下使用，不同场景对应不同的业务逻辑，需要验证的字段和方式也就不一样，这个时候就需要用到验证场景</p>
<h4 id="定义验证场景"><a href="#定义验证场景" class="headerlink" title="定义验证场景"></a>定义验证场景</h4><p>model 中定义验证场景<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class User extends Model</span><br><span class="line">&#123;</span><br><span class="line">    public function scenarios()</span><br><span class="line">    &#123;</span><br><span class="line">        // 默认验证场景 default 的验证字段</span><br><span class="line">        $scenarios = parent::scenarios();</span><br><span class="line">        </span><br><span class="line">        // 登录时候，验证用户名和密码</span><br><span class="line">        $scenarios[&apos;login&apos;] = [&apos;username&apos;, &apos;password&apos;];</span><br><span class="line">        </span><br><span class="line">        // 注册的时候要验证用户名、密码、确认密码</span><br><span class="line">        $scenarios[&apos;register&apos;] = [&apos;username&apos;, &apos;password&apos;, &apos;confirm_password&apos;];</span><br><span class="line">        return $scenarios;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="为规则指定验证场景"><a href="#为规则指定验证场景" class="headerlink" title="为规则指定验证场景"></a>为规则指定验证场景</h4><p>还是上面那个model<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 定义验证规则</span><br><span class="line"> */</span><br><span class="line">public function rules</span><br><span class="line">&#123;</span><br><span class="line">   return [</span><br><span class="line">        // 一样定义通用验证</span><br><span class="line">        [[&apos;username&apos;, &apos;password&apos;], &apos;trim&apos;],</span><br><span class="line">   </span><br><span class="line">        // on 定义使用的验证场景 可以是字符串，也可以是数组</span><br><span class="line">        [[&apos;username&apos;, &apos;password&apos;], &apos;required&apos;, &apos;on&apos; =&gt; [&apos;login&apos;, &apos;register&apos;]],</span><br><span class="line">        [&apos;confirm_password&apos;, &apos;required&apos;, &apos;on&apos; =&gt; &apos;register&apos;],</span><br><span class="line">        [&apos;confirm_password&apos;, &apos;compare&apos;, &apos;compareAttribute&apos; =&gt; &apos;password&apos;, &apos;on&apos; =&gt; &apos;register&apos;],</span><br><span class="line">   ]; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="使用验证场景"><a href="#使用验证场景" class="headerlink" title="使用验证场景"></a>使用验证场景</h4><p> 一般在控制器中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public function actionLogin()</span><br><span class="line">&#123;</span><br><span class="line">    // 使用验证场景</span><br><span class="line">    $user = new User();</span><br><span class="line">    $user-&gt;scenario = &apos;login&apos;;</span><br><span class="line">    </span><br><span class="line">    // 或者在实例化指定验证场景</span><br><span class="line">    $user = new User([&apos;scenario&apos; =&gt; &apos;login&apos;]);</span><br><span class="line">    </span><br><span class="line">    // 对model的属性进行赋值</span><br><span class="line">    $user-&gt;username = &apos;123&apos;;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    // 显示的调用验证</span><br><span class="line">    if ($user-&gt;validate()) &#123;</span><br><span class="line">        // 通过验证</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 获取到错误信息</span><br><span class="line">        var_dump($user-&gt;getErrors());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 执行save()的时候会调用validate() 方法</span><br><span class="line">     * 除非save() 调用时指定不走验证</span><br><span class="line">     * $user-&gt;save(false)</span><br><span class="line">     */</span><br><span class="line">    if ($user-&gt;save()) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;  else &#123;</span><br><span class="line">        var_dump($user-&gt;getErrors());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="验证规则使用注意"><a href="#验证规则使用注意" class="headerlink" title="验证规则使用注意"></a>验证规则使用注意</h4><p>执行验证是通过rules 中的规则，从上往下验证的，一旦验证不通过，不会向下验证, 建议关于数据库的验证，尽量放到最后</p>
<h2 id="数据的操作"><a href="#数据的操作" class="headerlink" title="数据的操作"></a>数据的操作</h2><h3 id="块赋值"><a href="#块赋值" class="headerlink" title="块赋值"></a>块赋值</h3><p>块赋值只用一行代码将用户所有输入填充到一个模型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$user = new User();</span><br><span class="line">$user-&gt;attributes = Yii::$app-&gt;request-&gt;post(&apos;User&apos;, []);</span><br><span class="line"></span><br><span class="line">// 等同于</span><br><span class="line">$user = new User();</span><br><span class="line">$data = Yii::$app-&gt;request-&gt;post(&apos;User&apos;, []);</span><br><span class="line">$user-&gt;username = isset($data[&apos;username&apos;]) ? $data[&apos;username&apos;] : null;</span><br><span class="line">$user-&gt;password = isset($data[&apos;password&apos;]) ? $data[&apos;password&apos;] : null;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>使用load() 方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$user = new User();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 默认使用Yii 表单</span><br><span class="line"> * 提交的表单数组应该为 </span><br><span class="line"> * 表单元素 &lt;input type=&quot;text&quot; name=&quot;User[username]&quot; /&gt;</span><br><span class="line"> * [</span><br><span class="line"> *      &apos;User&apos; =&gt; [&apos;username&apos; =&gt; &apos;username&apos;, &apos;password&apos; =&gt; &apos;password&apos;]</span><br><span class="line"> * ] </span><br><span class="line"> */ </span><br><span class="line">$user-&gt;load(Yii::$app-&gt;request-&gt;post());</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 没有使用yii表单</span><br><span class="line"> * &lt;input type=&quot;text&quot; name=&quot;username&quot; &gt;</span><br><span class="line"> * 对应提交的值</span><br><span class="line"> * [&apos;username&apos; =&gt; &apos;username&apos;, &apos;password&apos; =&gt; &apos;&apos;]</span><br><span class="line"> */</span><br><span class="line">$user-&gt;load(Yii::$app-&gt;request-&gt;post(), &apos;&apos;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用属性 attributes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * attributes 需要接收一个数组 </span><br><span class="line"> * [属性字段 =&gt; 对应值]</span><br><span class="line"> */</span><br><span class="line">$user-&gt;attributes = Yii::$app-&gt;request-&gt;post(&apos;User&apos;, []);</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 setAttributes() 方法(前面两种最终都是调用的 setAttributes() 方法)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$user = new User();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 需要接收一个数组</span><br><span class="line"> * [属性字段 =&gt; 对应值]</span><br><span class="line"> */</span><br><span class="line">$user-&gt;setAttributes(Yii::$app-&gt;request-&gt;post());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="块赋值注意"><a href="#块赋值注意" class="headerlink" title="块赋值注意"></a>块赋值注意</h4><ol>
<li>需要定义为安全的字段才可以赋值成功</li>
<li>在没有定义场景的情况下,定义了规则的字段、便会认为是安全的，可以块赋值成功</li>
<li>定义了验证场景,只有场景定义的字段可以批量赋值</li>
</ol>
<h3 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$user = new User();</span><br><span class="line">$user-&gt;username = &apos;username&apos;;</span><br><span class="line">$user-&gt;password = &apos;password&apos;;</span><br><span class="line">$user-&gt;insert();</span><br><span class="line"></span><br><span class="line">// 或者使用</span><br><span class="line">$user-&gt;save();</span><br></pre></td></tr></table></figure>
<h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><ul>
<li><p>查询对象修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$user = User::findOne(1);</span><br><span class="line">$user-&gt;username = &apos;username&apos;;</span><br><span class="line">$user-&gt;password = &apos;password&apos;;</span><br><span class="line">$user-&gt;update();</span><br><span class="line"></span><br><span class="line">// 或者使用</span><br><span class="line">$user-&gt;save();</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改指定数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 将ID 等于 2的用户的状态改为 1, 第二个参数同 where() 方法中的参数</span><br><span class="line">$intNumber = User::updateAll([&apos;status&apos; =&gt; 1], [&apos;id&apos; =&gt; 2]]);</span><br><span class="line"></span><br><span class="line">// 使用字符的绑定参数查询修改</span><br><span class="line">User::updateAll([&apos;status&apos; =&gt; 2], &apos;id=:id&apos;, [&apos;:id&apos; =&gt; 1]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>属性值实现累加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * updateAllCounters</span><br><span class="line"> * 第一个参数: 字段对应累加 正数值、累减的值 负数值</span><br><span class="line"> * 第二个参数: 查询条件 同where() 方法，可以字符串，数组</span><br><span class="line"> * 第三个参数: 查询绑定的参数</span><br><span class="line"> */</span><br><span class="line">User::updateAllCounters([&apos;status&apos; =&gt; -2], &apos;id=:id&apos;, [&apos;:id&apos; =&gt; 1]);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><ul>
<li><p>使用查询对象删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$user = User::findOne(1);</span><br><span class="line">$user-&gt;delete()</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除指定数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User::deleteAll([&apos;status&apos; =&gt; 0]);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="AR的生命周期"><a href="#AR的生命周期" class="headerlink" title="AR的生命周期"></a>AR的生命周期</h3><p>AR的生命周期<br>理解AR的生命周期对于你操作数据库非常重要。生命周期通常都会有些典型的事件存在。对于开发AR的behaviors来说非常有用。</p>
<ul>
<li>当你实例化一个新的AR对象时，我们将获得如下的生命周期：</li>
</ul>
<p>constructor<br>yii\db\ActiveRecord::init(): 会触发一个 yii\db\ActiveRecord::EVENT_INIT 事件</p>
<ul>
<li>当你通过 find() 方法查询数据时，每个AR实例都将有以下生命周期：</li>
</ul>
<p>constructor</p>
<ol>
<li>yii\db\ActiveRecord::init(): 会触发一个 yii\db\ActiveRecord::EVENT_INIT 事件</li>
<li>yii\db\ActiveRecord::afterFind(): 会触发一个 yii\db\ActiveRecord::EVENT_AFTER_FIND 事件</li>
</ol>
<ul>
<li>当通过 yii\db\ActiveRecord::save() 方法写入或者更新数据时, 我们将获得如下生命周期：</li>
</ul>
<ol>
<li>yii\db\ActiveRecord::beforeValidate(): 会触发一个  yii\db\ActiveRecord::EVENT_BEFORE_VALIDATE 事件</li>
<li>yii\db\ActiveRecord::afterValidate(): 会触发一个 yii\db\ActiveRecord::EVENT_AFTER_VALIDATE 事件</li>
<li>yii\db\ActiveRecord::beforeSave(): 会触发一个 yii\db\ActiveRecord::EVENT_BEFORE_INSERT 或 yii\db\ActiveRecord::EVENT_BEFORE_UPDATE 事件</li>
<li>yii\db\ActiveRecord::afterSave(): 会触发一个 yii\db\ActiveRecord::EVENT_AFTER_INSERT 或 yii\db\ActiveRecord::EVENT_AFTER_UPDATE 事件</li>
</ol>
<ul>
<li>最后，当调用 delete() 删除数据时, 我们将获得如下生命周期：</li>
</ul>
<ol>
<li>yii\db\ActiveRecord::beforeDelete(): 会触发一个 yii\db\ActiveRecord::EVENT_BEFORE_DELETE 事件<br>执行实际的数据删除</li>
<li>yii\db\ActiveRecord::afterDelete(): 会触发一个 yii\db\ActiveRecord::EVENT_AFTER_DELETE 事件</li>
</ol>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li>Yii2中文社区 <a href="http://www.yiichina.com/" target="_blank" rel="noopener">http://www.yiichina.com/</a></li>
<li>深入理解Yii2.0 <a href="http://www.digpage.com/index.html" target="_blank" rel="noopener">http://www.digpage.com/index.html</a></li>
<li>看云Yii学习<a href="https://www.kancloud.cn/curder/yii/247740" target="_blank" rel="noopener">https://www.kancloud.cn/curder/yii/247740</a></li>
<li>文档 <a href="http://www.awaimai.com/patterns" target="_blank" rel="noopener">http://www.awaimai.com/patterns</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/10/php-mongo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/10/php-mongo/" class="post-title-link" itemprop="url">PHP操作MongoDB</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-10 10:36:38" itemprop="dateCreated datePublished" datetime="2019-05-10T10:36:38+08:00">2019-05-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="PHP连接MongoDB"><a href="#PHP连接MongoDB" class="headerlink" title="PHP连接MongoDB"></a>PHP连接MongoDB</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$connection = new Mongo();</span><br><span class="line"></span><br><span class="line">// 负载均衡</span><br><span class="line">$conn = new Mongo(&apos;localhost&apos;, array(&apos;replicaSet&apos; =&gt; true));</span><br><span class="line"></span><br><span class="line">// 持久连接</span><br><span class="line">$conn = new Mongo(&apos;localhost&apos;, array(&apos;persist&apos; =&gt; &apos;t&apos;));</span><br><span class="line">    </span><br><span class="line">// 带用户名和密码</span><br><span class="line">$conn = new Mongo(&apos;mongodb://root:123@localhost&apos;);</span><br></pre></td></tr></table></figure>
<h4 id="选择数据库-和-集合"><a href="#选择数据库-和-集合" class="headerlink" title="选择数据库 和 集合"></a>选择数据库 和 集合</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 选择数据库</span><br><span class="line">$db = $connection-&gt;mydata;</span><br><span class="line"></span><br><span class="line">// 选择集合</span><br><span class="line">$collection = $db-&gt;user;                  </span><br><span class="line">// 选择集合的另一种方式</span><br><span class="line">$collection = $db-&gt;selectCollection(&apos;user&apos;);</span><br><span class="line"></span><br><span class="line">// 简洁写法</span><br><span class="line">$collection = $db-&gt;mydata-&gt;user;</span><br></pre></td></tr></table></figure>
<h4 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h4><ul>
<li><p>简单新增</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * $collection-&gt;insert() ) ^.^ ---&gt;</span><br><span class="line"> * insert($array[, $arr = array(</span><br><span class="line"> *  &apos;safe&apos; =&gt; false,</span><br><span class="line"> *  &apos;fsync&apos; =&gt; false,</span><br><span class="line"> *  &apos;timeout&apos; =&gt; 10000,</span><br><span class="line"> * )])</span><br><span class="line"> * @param array $array 添加数据信息</span><br><span class="line"> * @param $arr 额外参数信息( 可选 )</span><br><span class="line"> *        $arr[&apos;safe&apos;]    boolean 是否安全写入(false)</span><br><span class="line"> *        $arr[&apos;fsync&apos;]    boolean 是否强制插入到同步磁盘(false)</span><br><span class="line"> *        $arr[&apos;timeout&apos;] int        超时间( 毫秒 )</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">// 简单新增 , 返回布尔值 bool(true)</span><br><span class="line">$result = $collection-&gt;insert(array(</span><br><span class="line">    &apos;username&apos; =&gt; &apos;myCeshi&apos;,</span><br><span class="line">    &apos;age&apos; =&gt; 12,</span><br><span class="line">    &apos;time&apos; =&gt; time(),</span><br><span class="line">    &apos;skills&apos; =&gt; array(&apos;php&apos;, &apos;javascript&apos;, &apos;css&apos;, &apos;html&apos;),</span><br><span class="line">));</span><br></pre></td></tr></table></figure>
</li>
<li><p>向集合中安全插入数据,返回插入状态(数组)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// 用于等待MongoDB完成操作,以便确定是否成功(当有大量记录插入时使用该参数会比较有用)</span><br><span class="line">$result = $collection-&gt;insert(array(</span><br><span class="line">    &apos;username&apos; =&gt; &apos;liujx&apos;,</span><br><span class="line">    &apos;age&apos; =&gt; 22,</span><br><span class="line">);, true);  </span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">    return array(</span><br><span class="line">        &apos;connectionId&apos; =&gt; int 10</span><br><span class="line">        &apos;n&apos; =&gt; int 0</span><br><span class="line">        &apos;syncMillis&apos; =&gt; int 0</span><br><span class="line">        &apos;writtenTo&apos; =&gt; null</span><br><span class="line">        &apos;err&apos; =&gt; null</span><br><span class="line">        &apos;ok&apos; =&gt; float 1</span><br><span class="line">    ) ;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * update(</span><br><span class="line">    array $criteria, </span><br><span class="line">    array $new[, </span><br><span class="line">    array $options = array()</span><br><span class="line">    ]</span><br><span class="line"> )</span><br><span class="line"> * @param    array $criteria 查询修改对象数组</span><br><span class="line"> * @param    array $new 修改成的新对象数组</span><br><span class="line"> * @param    array $options 更新的其他设置数组</span><br><span class="line"> * @return    boolean 返回布尔值</span><br><span class="line"> *</span><br><span class="line"> * 更新数据说明</span><br><span class="line"> * $inc    自增</span><br><span class="line"> * $set    修改</span><br><span class="line"> * $unset    删除字段</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<ol>
<li><p>修改更新 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 修改一条</span><br><span class="line">$result = $collection-&gt;update(</span><br><span class="line">    array(</span><br><span class="line">        &apos;username&apos; =&gt; &apos;myCeshi&apos;</span><br><span class="line">    ), </span><br><span class="line">    array(</span><br><span class="line">        &apos;$set&apos; =&gt; array(</span><br><span class="line">            &apos;username&apos; =&gt; &apos;myTitle&apos;,</span><br><span class="line">            &apos;name&apos; =&gt; &apos;xiaoTitle&apos;</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>替换更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 替换一条</span><br><span class="line">$result = $collection-&gt;update(</span><br><span class="line">    array(</span><br><span class="line">        &apos;username&apos; =&gt; &apos;myCeshi&apos;</span><br><span class="line">    ), </span><br><span class="line">    array(</span><br><span class="line">        &apos;myname&apos; =&gt; &apos;123&apos;, </span><br><span class="line">        &apos;title&apos; =&gt; &apos;nonoe&apos;</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>批量更新 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$update = array();</span><br><span class="line">$result = $collection-&gt;update(</span><br><span class="line">    array(</span><br><span class="line">        &apos;username&apos; =&gt; &apos;myCeshi&apos;</span><br><span class="line">    ), </span><br><span class="line">    array(</span><br><span class="line">        &apos;$set&apos; =&gt; array(</span><br><span class="line">            &apos;myname&apos; =&gt; &apos;123&apos;, </span><br><span class="line">            &apos;title&apos; =&gt; &apos;nonoe&apos;</span><br><span class="line">        )</span><br><span class="line">    ), </span><br><span class="line">    array(</span><br><span class="line">        &apos;multiple&apos; =&gt; true</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>自动累加 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// age累加5( 修改一条 )</span><br><span class="line">$result = $collection-&gt;update(</span><br><span class="line">    array(</span><br><span class="line">        &apos;username&apos; =&gt; &apos;myTitle&apos;</span><br><span class="line">    ), </span><br><span class="line">    array(</span><br><span class="line">        &apos;$inc&apos; =&gt; array(</span><br><span class="line">            &apos;age&apos; =&gt; 5</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="删除数据-remove"><a href="#删除数据-remove" class="headerlink" title="删除数据 remove()"></a>删除数据 remove()</h4><ul>
<li><p>删除指定数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$result = $collection-&gt;remove(array(</span><br><span class="line">    &apos;username&apos; =&gt; &apos;myTitle&apos;</span><br><span class="line">));</span><br></pre></td></tr></table></figure>
</li>
<li><p>清空集合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$collection-&gt;remove();</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除指定的MongoId</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = new MongoId(&apos;557016db90428ba817000012&apos;);</span><br><span class="line">$result = $collection-&gt;remove(array(&apos;_id&apos; =&gt; $id));</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="查询数据-find-和-findOne"><a href="#查询数据-find-和-findOne" class="headerlink" title="查询数据 find() 和 findOne()"></a>查询数据 find() 和 findOne()</h4><ul>
<li>查询数据数目 count()<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$num = $collection-&gt;count();</span><br><span class="line"></span><br><span class="line">// 查询满足条件的数据</span><br><span class="line">$num = $collection-&gt;count(array(</span><br><span class="line">    &apos;username&apos; =&gt; &apos;liujx&apos;</span><br><span class="line">));   </span><br><span class="line"></span><br><span class="line">// 查询满足条件数据条数</span><br><span class="line">$num = $collection-&gt;count(array(</span><br><span class="line">    &apos;age&apos; =&gt; array(</span><br><span class="line">        &apos;$gt&apos; =&gt; 12, </span><br><span class="line">        &apos;$lt&apos; =&gt; 30</span><br><span class="line">    )</span><br><span class="line">));</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li>$gt为大于</li>
<li>$gte为大于等于</li>
<li>$lt为小于</li>
<li>$lte为小于等于</li>
<li>$ne为不等于</li>
<li>$exists不存在</li>
</ol>
<ul>
<li><p>findOne() 查询一条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * findOne() 查询一条数据</span><br><span class="line"> * @param    array $criteria 查询条件数组</span><br><span class="line"> * @return    array    返回数组( 没有数据返回 null )</span><br><span class="line"> */</span><br><span class="line">$data = $collection-&gt;findOne();</span><br><span class="line">$data = $collection-&gt;findOne(array(</span><br><span class="line">    &apos;username&apos; =&gt; &apos;liujx&apos;</span><br><span class="line">));</span><br></pre></td></tr></table></figure>
</li>
<li><p>find() 查询数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * find() 查询数据</span><br><span class="line"> * @param    array $criteria 查询条件数组</span><br><span class="line"> * @return  object    返回对象( 没有返回 null )</span><br><span class="line"> * 注意:</span><br><span class="line"> * 在我们做了find()操作，获得$cursor游标之后，这个游标还是动态的.</span><br><span class="line"> * 换句话说,在我find()之后,到我的游标循环完成这段时间,如果再有符合条件的记录被插入到collection,那么这些记录也会被$cursor 获得.</span><br><span class="line"> * 如果你想在获得$cursor之后的结果集不变化,需要这样做：</span><br><span class="line"> * $cursor = $collection-&gt;find();</span><br><span class="line"> * $cursor-&gt;snapshot();</span><br><span class="line"> */</span><br><span class="line">$data = $collection-&gt;find();                        // 查询所有数据,返回对象</span><br><span class="line">foreach ($data as $key =&gt; $value) &#123;</span><br><span class="line">    // var_dump($value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li><p>限制查询条数limit()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = $collection-&gt;find()-&gt;limit(5);</span><br></pre></td></tr></table></figure>
</li>
<li><p>确定查询开始位置skip()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$data = $collection-&gt;find()-&gt;limit(10)-&gt;skip(5);</span><br></pre></td></tr></table></figure>
</li>
<li><p>排序条件查询sort() </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$data = $collection-&gt;find()-&gt;limit(10)-&gt;sort(array(&apos;_id&apos; =&gt; -1));</span><br><span class="line">// $data = $data-&gt;snapshot() ; 					# 排序和snapshot();</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定查询的列 fields() true 显示 false 不显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$data = $collection-&gt;find()-&gt;limit(10)-&gt;fields(array(&apos;_id&apos; =&gt; false));    // _id 列不显示</span><br><span class="line">// $data = $collection-&gt;find()-&gt;limit(10)-&gt;sort(array(&apos;_id&apos; =&gt; -1 ))-&gt;fields(array(&apos;username&apos;=&gt; true)) ; # 只显示username(_id默认显示)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="索引操作-ensureIndex"><a href="#索引操作-ensureIndex" class="headerlink" title="索引操作 ensureIndex()"></a>索引操作 ensureIndex()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ensureIndex(</span><br><span class="line">        array(), </span><br><span class="line">        array(</span><br><span class="line">            &apos;name&apos; =&gt;&apos;索引名称&apos;,</span><br><span class="line">            &apos;background&apos; =&gt; true , </span><br><span class="line">            &apos;unique&apos; =&gt; true</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"> * 详见:http://www.php.net/manual/en/mongocollection.ensureindex.php</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">// 表示降序 -1表示升序</span><br><span class="line">$collection-&gt;ensureIndex(array(</span><br><span class="line">    &apos;age&apos; =&gt; 1, </span><br><span class="line">    &apos;type&apos; =&gt; -1</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">// 索引的创建放在后台运行(默认是同步运行)</span><br><span class="line">$collection-&gt;ensureIndex(</span><br><span class="line">    array(</span><br><span class="line">        &apos;age&apos; =&gt; 1, </span><br><span class="line">        &apos;type&apos; =&gt; -1</span><br><span class="line">    ), </span><br><span class="line">    array(</span><br><span class="line">        &apos;background&apos; =&gt; true</span><br><span class="line">    )</span><br><span class="line">); </span><br><span class="line"></span><br><span class="line">// 该索引是唯一的</span><br><span class="line">$collection-&gt;ensureIndex(</span><br><span class="line">    array(</span><br><span class="line">        &apos;age&apos; =&gt; 1, </span><br><span class="line">        &apos;type&apos; =&gt; -1</span><br><span class="line">    ), </span><br><span class="line">    array(</span><br><span class="line">        &apos;unique&apos; =&gt; true</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="关闭连接-close"><a href="#关闭连接-close" class="headerlink" title="关闭连接 close()"></a>关闭连接 close()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$connection-&gt;close();</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/10/mongo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/10/mongo/" class="post-title-link" itemprop="url">MongoDB学习</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-10 10:35:40" itemprop="dateCreated datePublished" datetime="2019-05-10T10:35:40+08:00">2019-05-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Window-环境安装MongoDB"><a href="#Window-环境安装MongoDB" class="headerlink" title="Window 环境安装MongoDB"></a>Window 环境安装MongoDB</h3><ol>
<li>下载安装 Mongodb</li>
<li>设置MongoDB 为wondows服务项( 配置环境变量 d:/MongoDB/bin) wind + R  cmd.exe</li>
<li><p>启动MongoDB</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --logpath d:/server/mongo/logs/logs.txt --logappend --dbpath d:/server/mongo/data --directoryperdb --serviceName MongoDB -install</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<ul>
<li>–logpath             日志文件地址</li>
<li>–logappend            添加日志的方式为追加</li>
<li>–dbpath                指定MongoDB数据存放的路径</li>
<li>–directoryperdb        MongoDB按照数据库的不同，针对每一个数据库都建立一个目录，所谓的“目录每数据库</li>
<li>–auth                是否使用用户验证</li>
<li>–serviceName        安装Windows服务时使用的服务名</li>
<li>–install            安装MongoDB服务</li>
</ul>
<ol start="4">
<li>启动MongoDB服务 net start MongoDB</li>
<li>关闭MongoDB服务 net stop MongoDB</li>
<li>使用MongoDB 需要先启动MongoDB 然后 mongo</li>
</ol>
</li>
</ol>
<h3 id="添加用户和角色"><a href="#添加用户和角色" class="headerlink" title="添加用户和角色"></a>添加用户和角色</h3><ol>
<li>添加用户使用db.createUser( user , writeConcern ) 函数使用说明</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param object user 			这个文档创建关于用户的身份认证和访问信息</span><br><span class="line"> * @param mixed writeConcern	这个文档描述保证MongoDB提供写操作的成功报告。</span><br><span class="line"> */</span><br><span class="line">var user = &#123;</span><br><span class="line">	&quot;user&quot;: &quot;root&quot;,								// 用户名</span><br><span class="line">	&quot;pwd&quot;: &quot;loveme&quot;,								// 密码</span><br><span class="line">	&quot;customData&quot;: &#123;employeeId: 12345&#125;,			// 用户说明</span><br><span class="line">	&quot;roles&quot;: [				</span><br><span class="line">		&#123;</span><br><span class="line">		    role: &quot;clusterAdmin&quot;, </span><br><span class="line">		    db: &quot;admin&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">		    role: &quot;readAnyDatabase&quot;, </span><br><span class="line">		    db: &quot;admin&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;readWrite&quot;</span><br><span class="line">	]												// 用户角色</span><br><span class="line">&#125;;</span><br><span class="line">var write = &#123;w: &quot;majority&quot;, wtimeout: 5000&#125;;</span><br><span class="line">db.createUser(user, write);</span><br><span class="line">/*</span><br><span class="line">	Built-In Roles（内置角色）：</span><br><span class="line">		1. 数据库用户角色：read、readWrite;</span><br><span class="line">		2. 数据库管理角色：dbAdmin、dbOwner、userAdmin；</span><br><span class="line">		3. 集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；</span><br><span class="line">		4. 备份恢复角色：backup、restore；</span><br><span class="line">		5. 所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</span><br><span class="line">		6. 超级用户角色：root  </span><br><span class="line">		// 这里还有几个角色间接或直接提供了系统超级用户的访问（dbOwner 、userAdmin、userAdminAnyDatabase）</span><br><span class="line">		7. 内部角色：__system</span><br><span class="line">		PS：关于每个角色所拥有的操作权限可以点击上面的内置角色链接查看详情。</span><br><span class="line">	writeConcern文档( 官方说明 )</span><br><span class="line">		w选项：允许的值分别是 1、0、大于1的值、&quot;majority&quot;、&lt;tag set&gt;.</span><br><span class="line">		j选项：确保mongod实例写数据到磁盘上的journal（日志）,这可以确保mongd以外关闭不会丢失数据。设置true启用.</span><br><span class="line">		wtimeout：指定一个时间限制,以毫秒为单位。wtimeout只适用于w值大于1.</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<h4 id="登录验证"><a href="#登录验证" class="headerlink" title="登录验证"></a>登录验证</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongo -u root -p loveme --authenticationDatabase test;</span><br><span class="line">db.auth(&quot;root&quot;, &quot;loveme&quot;) ; // 验证</span><br></pre></td></tr></table></figure>
<h4 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.system.user.remove(&#123;&quot;user&quot;: &quot;root&quot;&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="MongoDB添加库"><a href="#MongoDB添加库" class="headerlink" title="MongoDB添加库"></a>MongoDB添加库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 选择库</span><br><span class="line">use mydata</span><br><span class="line"></span><br><span class="line">// 删除库</span><br><span class="line">db.dropDatabase();</span><br></pre></td></tr></table></figure>
<h4 id="MongoDB添加表"><a href="#MongoDB添加表" class="headerlink" title="MongoDB添加表"></a>MongoDB添加表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 添加表</span><br><span class="line">db.createCollection(&quot;collection_name&quot;); </span><br><span class="line"></span><br><span class="line">// 删除表</span><br><span class="line">db.collection_name.drop() ;</span><br></pre></td></tr></table></figure>
<h3 id="MongoDB-数据库操作"><a href="#MongoDB-数据库操作" class="headerlink" title="MongoDB 数据库操作"></a>MongoDB 数据库操作</h3><h4 id="新增数据-insert-和-save"><a href="#新增数据-insert-和-save" class="headerlink" title="新增数据 insert() 和 save()"></a>新增数据 insert() 和 save()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 新增数据时&apos;_id&apos; 不赋值默认自带赋值</span><br><span class="line">/**</span><br><span class="line"> * db.collection_name.insert() 添加数据</span><br><span class="line"> * @param object objNew 新增数据</span><br><span class="line"> */</span><br><span class="line"> db.user.insert(&#123;&quot;_id&quot;: 1, &quot;name&quot;: &quot;lovemeljx&quot;&#125;);</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line"> * db.collection_name.save( objNew ) </span><br><span class="line"> * 新增数据(_id存在不新增)</span><br><span class="line"> * @param object objNew 更新的对象</span><br><span class="line"> */</span><br><span class="line">db.td_user.save(&#123;&quot;name&quot;: &quot;123&quot;, &quot;username&quot;: &quot;ljx&quot;&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="查询-find"><a href="#查询-find" class="headerlink" title="查询 find()"></a>查询 find()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.collection_name.find() ;	</span><br><span class="line">// 查询所有 SQL: SELECT * FROM `user` ;	</span><br><span class="line">db.user.find() ;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>指定返回指定的列 ( 键 ) </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQL：SELECT `name`,`age` FROM `user` ;</span><br><span class="line"></span><br><span class="line">db.user.find(&#123;&#125;, &#123;&quot;name&quot;: 1, &quot;age&quot;: 1&#125;) ;</span><br><span class="line">/* 补充说明:第一个&#123;&#125; 放where条件 第二个&#123;&#125; 指定那些列显示和不显示( 0 不显示 1 显示) */</span><br></pre></td></tr></table></figure>
</li>
<li><p>WHERE 条件 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL: SELECT `name`,`age` FROM `user` WHERE `name`=&apos;123&apos; ;</span><br><span class="line"></span><br><span class="line">db.user.find(&#123;&quot;name&quot;: &quot;123&quot;&#125;, &#123;&quot;name&quot;: 1, &quot;age&quot;: 1&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 AND </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL: SELECT * FROM `user` WHERE `name`=&apos;123&apos; AND `age`=21 ;</span><br><span class="line"></span><br><span class="line">db.user.find(&#123;&quot;name&quot;: &quot;123&quot;, &quot;age&quot;: 21&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 OR( $or ) </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL: SELECT * FROM `user` WHERE `name`=&apos;123&apos; OR `age`=21 ;</span><br><span class="line"></span><br><span class="line">db.user.find(&#123;&quot;$or&quot;: [&#123;&quot;name&quot;: &quot;123&quot;&#125;, &#123;&quot;age&quot;: 18&#125;&#125;]&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 &lt; &lt;= &gt; &gt;= !=( $lt , $lte , $gt , $gte , $ne ) </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL: SELECT * FROM `user` WHERE `id`&gt;1 AND `id`&lt;=3 ;</span><br><span class="line"></span><br><span class="line">db.user.find(&#123;&quot;_id&quot;: &#123;&quot;$gt&quot;: 1, &quot;$lte&quot;: 3&#125;&#125;) ;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 IN NOT IN ( $in , $nin )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL: SELECT * FROM `user` WHERE `id` IN (1,3,5) ;</span><br><span class="line"></span><br><span class="line">db.user.find(&#123;&quot;_id&quot;: &#123;&quot;$in&quot;: [1, 2, 5]&#125;&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>匹配 null </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL: SELECT * FROM `user` WHERE `name` IS NULL ;</span><br><span class="line"></span><br><span class="line">db.user.find(&#123;&quot;name&quot;: null&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>LIKE模糊查询 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL: SELECT * FROM `user` WHERE `name` LIKE &apos;%123%&apos;;</span><br><span class="line"></span><br><span class="line">db.user.find(&#123;&quot;name&quot;: /123/&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>去掉重复的数据 DISTINCT </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL: SELECT DISTINCT(`name`) FROM `user`;</span><br><span class="line"></span><br><span class="line">db.user.distinct(&quot;name&quot;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计查询 COUNT </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SQL: SELECT COUNT(*) FROM `user`;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 查询统计条件可以传参数</span><br><span class="line"> * db.user.count(&#123;&quot;name&quot;: &quot;123&quot;&#125;);</span><br><span class="line"> * db.find(&#123;&quot;name&quot;: &quot;123&quot;&#125;).count();</span><br><span class="line">*/</span><br><span class="line">db.user.count() ;</span><br></pre></td></tr></table></figure>
</li>
<li><p>判断一个元素是否存在 $exists</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.td_user.find(&#123;&quot;username&quot;: &#123;&quot;$exists&quot;: true&#125;&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>取反 $not</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.td_user.find(&#123;&quot;username&quot;: &#123;&quot;$not&quot;: /123/&#125;&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>sort()排序条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 1 正序 -1 倒序</span><br><span class="line">db.user.find().sort(&#123;&quot;_id&quot;: -1&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询条数limit();</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().limit(10);</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询5-10间的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().limit(5).skip(5);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>16.数组查询(MongoDB特有)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * skills = [&quot;java&quot;, &quot;php&quot;, &quot;javascript&quot;, &quot;python&quot;] ;</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">// 找到skills</span><br><span class="line">db.user.find(&#123;&quot;skills&quot;: &quot;php&quot;&#125;);</span><br><span class="line"></span><br><span class="line">// $all ** 必须同时包含</span><br><span class="line">db.user.find(&#123;&quot;skills&quot;: &#123;&quot;$all&quot;: [&quot;java&quot;, &quot;php&quot;]&#125;&#125;);</span><br><span class="line"></span><br><span class="line">// $size ** 数组长度等于</span><br><span class="line">db.user.find(&#123;&quot;skills&quot;: &#123;&quot;$size&quot;: 2&#125;&#125;);</span><br><span class="line"></span><br><span class="line">// $slice ** </span><br><span class="line">db.user.find(&#123;&quot;skills&quot;: &#123;&quot;$slice&quot;: [1, 1]&#125;&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="修改-update-AND-save"><a href="#修改-update-AND-save" class="headerlink" title="修改 update() AND save()"></a>修改 update() AND save()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * db.collection_name.update(criteria, objNew, upsert, multi) </span><br><span class="line"> * @param object 	criteria 查询条件对象</span><br><span class="line"> * @param object	objNew	 更新的操作</span><br><span class="line"> * @param boolean	upsert   不存在是否添加</span><br><span class="line"> * @param boolean  	multi 	 是否全部跟新</span><br><span class="line"> */</span><br><span class="line"> db.user.update(criteria, objNew, upsert, multi)</span><br><span class="line">``` </span><br><span class="line">1. 修改一条数据</span><br></pre></td></tr></table></figure>
<p>db.td_user.update({“username”: “123”},  {$set: {“username”: 456}});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 全部修改</span><br></pre></td></tr></table></figure></p>
<p>db.td_user.update({“user”: “test”}, {$set: {“name”: “my-test”}}, false, true);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 不存在添加一条</span><br></pre></td></tr></table></figure></p>
<p>db.td_user.update({“user”: “my-test”}, {$set: {“user”: “test”}}, true, false);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 添加所有</span><br></pre></td></tr></table></figure></p>
<p>db.td_user.update({“user”: “my-test”}, {$set: {“user”: “test”}}, true, true);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">5. 全更新了</span><br></pre></td></tr></table></figure></p>
<p>db.td_user.update({“count”: {$gt: 15}}, {$inc: {“count”: 1}}, false, true);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6. 只更新了第一条</span><br></pre></td></tr></table></figure></p>
<p>db.td_user.update({“count”: {$gt: 10}}, {$inc: {“count”: 1}}, false, false);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 跟新说明</span><br><span class="line"></span><br><span class="line">* $inc 一个数字字段field增加value(数字)</span><br></pre></td></tr></table></figure></p>
<p>db.td_user.update({“username”: “love”}, {$inc: {“age”: 2}});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* $set 修改值(所有值都支持)</span><br></pre></td></tr></table></figure></p>
<p>db.td_user.update({“username”: “loveme”}, {$set: {“username”: “mylove”}});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* $unset 删除字段</span><br></pre></td></tr></table></figure></p>
<p>db.td_user.update({“username”: “mylove”}, {$unset: {“age”: 1}});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* $push 将值追加到数组中</span><br></pre></td></tr></table></figure></p>
<p>db.td_user.update({“username”: “mylove”}, {$push: {“age”: 23}});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 删除和修改数据 remove() AND findAndModify() AND runCommand() </span><br><span class="line">1. remove</span><br></pre></td></tr></table></figure></p>
<p>/**</p>
<ul>
<li>remove( criteria ) </li>
<li>@param object criteria 查询删除的对象<br>*/<br>db.user.remove({“_id”: 0});<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. findAndModify</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>/**</p>
<ul>
<li>findAndModify( objNew ) objNew.remove 和 objNew.update 不能同时存在 runCommand()同</li>
<li>@param objNew.query     查询对象</li>
<li>@param objNew.sort      排序条件</li>
<li>@param objNew.update 修改的数据</li>
<li>@param objNew.remove 是否删除数据<br>*/<br>db.user.findAndModify({<br> query: {“_id”: 1},<br> sort: {“_id”: -1},<br> update: {$set: {“username”: “loveme_user”}},<br> remove: false,<br>});</li>
</ul>
<p>for ( var i = 100 ; i&lt; 200 ; i ++  ) {<br>    db.user.save({<br>        “<em>id”: i + 1,<br>        “username”: “loveme</em>“ + i,<br>        “age” : 22<br>    });<br>}<br><code>`</code></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/09/php-concurrent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/09/php-concurrent/" class="post-title-link" itemprop="url">PHP面试-并发</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-09 18:35:33" itemprop="dateCreated datePublished" datetime="2019-05-09T18:35:33+08:00">2019-05-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul>
<li><a href="#高并发解决方案">高并发解决方案</a></li>
<li><a href="#缓存">缓存</a></li>
<li><a href="#数据库">MySQL数据库</a></li>
<li><a href="#脚本执行时间超时">Nginx</a></li>
</ul>
<h1 id="高并发解决方案"><a href="#高并发解决方案" class="headerlink" title="高并发解决方案"></a>高并发解决方案</h1><ul>
<li><p>硬件方面：</p>
<p>  服务器性能： 网络-硬盘读写速度-内存大小-CPU处理数度</p>
</li>
<li>软件方面：<ul>
<li>服务器： 使用nginx 代替 apache, nginx </li>
<li>开启GZIP压缩优化网站、压缩网站内容可以节省网站流量</li>
<li>构架部署：<ul>
<li>HTML静态化</li>
<li>前端资源服务器分离(文件单独部署服务器)</li>
<li>数据库集群、库表散列（数据库读写分离、使用索引、分表）</li>
<li>缓存（redis、memcache）</li>
<li>负载均衡</li>
<li>CDN加速</li>
</ul>
</li>
</ul>
</li>
<li><p>PHP:</p>
<ul>
<li>升级PHP版本到PHP7</li>
<li>加载近可能少的模块（关闭不需要的模块）</li>
<li>使用Opcache</li>
</ul>
</li>
<li><p>代码层面的优化：</p>
<ul>
<li>SQL查询的优化</li>
<li>尽量多使用内置函数</li>
</ul>
</li>
</ul>
<h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="Redis-简介："><a href="#Redis-简介：" class="headerlink" title="Redis 简介："></a>Redis 简介：</h3><p>Redis 是一个 key/value存储系统。和Memcache类似，它支持存储的value类型相当更多。包括 string(字符串)、list(链表)、set(集合)和zset(有序集合)。这些数据类型都支持 push/pop、add/remove 及取交集和差集及更丰富的操作，而且这些操作都是原子性的。这此基础上，Redis 支持各种不同方式的排序。与Memcached 一样，为了保证效率，数据都是缓存在内存中。区别是 Redis 会周期性的把跟新数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现master-slave（主从）同步</p>
<h3 id="Redis支持的数据类型"><a href="#Redis支持的数据类型" class="headerlink" title="Redis支持的数据类型"></a>Redis支持的数据类型</h3><h4 id="String-字符串"><a href="#String-字符串" class="headerlink" title="String(字符串)"></a>String(字符串)</h4><p>string是redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。<br>string类型是二进制安全的。意思是redis的string可以包含任何数据。比如jpg图片或者序列化的对象.string类型是Redis最基本的数据类型，一个键最大能存储512MB。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set name &apos;string&apos;</span><br><span class="line">get name</span><br><span class="line">string</span><br></pre></td></tr></table></figure>
<h4 id="Hash-哈希"><a href="#Hash-哈希" class="headerlink" title="Hash(哈希)"></a>Hash(哈希)</h4><p>Redis hash 是一个键名对集合。<br>Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 设置key 为 user 的 name 字段为 liujx</span><br><span class="line">hset user name liujx</span><br><span class="line">hget user name</span><br><span class="line">liujx</span><br><span class="line"></span><br><span class="line"># 同时设置多个字段</span><br><span class="line">hmset use name ljx age 18 </span><br><span class="line">hmget user name age</span><br><span class="line">ljx</span><br><span class="line">18</span><br></pre></td></tr></table></figure>
<h4 id="List-列表"><a href="#List-列表" class="headerlink" title="List(列表)"></a>List(列表)</h4><p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lpush users liujx</span><br><span class="line">rpop users</span><br><span class="line">liujx</span><br></pre></td></tr></table></figure></p>
<h4 id="Set-集合"><a href="#Set-集合" class="headerlink" title="Set(集合)"></a>Set(集合)</h4><p>Redis的Set是string类型的无序集合。<br>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sadd key member</span><br></pre></td></tr></table></figure>
<h4 id="zset-sorted-set：有序集合"><a href="#zset-sorted-set：有序集合" class="headerlink" title="zset(sorted set：有序集合)"></a>zset(sorted set：有序集合)</h4><p>Redis zset 和 set 一样也是string类型元素的集合,且不允许重复的成员。<br>不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。<br>zset的成员是唯一的,但分数(score)却可以重复。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zadd key member</span><br></pre></td></tr></table></figure></p>
<h2 id="Memcache"><a href="#Memcache" class="headerlink" title="Memcache"></a>Memcache</h2><p>Memcache 简介：</p>
<p>Memcache 是一种高性能、分布式对象缓存系统，最初设计与缓解动态网站数据库加载的延迟性，你可以把它想象成一个大的内存HashTable,就是一个 key/value 键值对缓存</p>
<h3 id="Redis-和-Memcache-区别"><a href="#Redis-和-Memcache-区别" class="headerlink" title="Redis 和 Memcache 区别"></a>Redis 和 Memcache 区别</h3><ol>
<li>Redis 支持更加丰富的数据存储类型，String、Hash、List、Set 和 Sorted Set。Memcached 仅支持简单的 key-value 结构。</li>
<li>Memcached key-value存储比 Redis 采用 hash 结构来做 key-value 存储的内存利用率更高。</li>
<li>Redis 提供了事务的功能，可以保证一系列命令的原子性</li>
<li>Redis 支持数据的持久化，可以将内存中的数据保持在磁盘中</li>
<li>Redis 只使用单核，而 Memcached 可以使用多核，所以平均每一个核上 Redis 在存储小数据时比 Memcached 性能更高。</li>
</ol>
<h4 id="Redis-如何实现持久化"><a href="#Redis-如何实现持久化" class="headerlink" title="Redis 如何实现持久化"></a>Redis 如何实现持久化</h4><ol>
<li>RDB 持久化，将 Redis 在内存中的的状态保存到硬盘中，相当于备份数据库状态。</li>
<li>AOF 持久化（Append-Only-File），AOF 持久化是通过保存 Redis 服务器锁执行的写状态来记录数据库的。相当于备份数据库接收到的命令，所有被写入 AOF 的命令都是以 Redis 的协议格式来保存的。</li>
</ol>
<h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><h3 id="MyISAM-与-InnoDB的区别"><a href="#MyISAM-与-InnoDB的区别" class="headerlink" title="MyISAM 与 InnoDB的区别"></a>MyISAM 与 InnoDB的区别</h3><ul>
<li>InnoDB支持事务，MyISAM不支持，对于InnoDB每一条SQL语言都默认封装成事务，自动提交，这样会影响速度，所以最好把多条SQL语言放在begin和commit之间，组成一个事务</li>
<li>InnoDB支持外键，而MyISAM不支持</li>
<li>InnoDB是聚集索引，数据文件是和索引绑在一起的，必须要有主键，通过主键索引效率很高;而MyISAM是非聚集索引，数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的</li>
<li>Innodb不支持全文索引，而MyISAM支持全文索引，查询效率上MyISAM要高</li>
<li>MyISAM只支持表级锁,Innodb支持行级锁;但是InnoDB的行锁，只是在WHERE的主键是有效的，非主键的WHERE都会锁全表的</li>
</ul>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>作用</p>
<ul>
<li>能够大大提高查询效率</li>
<li>可以通过建立唯一索引或者主键索引,保证数据库表中每一行数据的唯一性.</li>
<li>建立索引可以大大提高检索的数据,以及减少表的检索行数</li>
<li>在分组和排序字句进行数据检索,可以减少查询时间中 分组 和 排序时所消耗的时间(数据库的记录会重新排序)</li>
</ul>
<p>索引也会有它的缺点：虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。建立索引会占用磁盘空间的索引文件</p>
<h3 id="普通索引"><a href="#普通索引" class="headerlink" title="普通索引"></a>普通索引</h3><p>这是最基本的索引，它没有任何限制，比如上文中为title字段创建的索引就是一个普通索引，MyIASM中默认的BTREE类型的索引，也是我们大多数情况下用到的索引。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">–- 直接创建索引</span><br><span class="line">CREATE INDEX index_name ON table(column(length))</span><br><span class="line"></span><br><span class="line">–- 修改表结构的方式添加索引</span><br><span class="line">ALTER TABLE table_name ADD INDEX index_name ON (column(length))</span><br><span class="line"></span><br><span class="line">–- 创建表的时候同时创建索引</span><br><span class="line">CREATE TABLE `table` (</span><br><span class="line">    `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">    `title` char(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,</span><br><span class="line">    `content` text CHARACTER SET utf8 COLLATE utf8_general_ci NULL ,</span><br><span class="line">    `time` int(10) NULL DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (`id`),</span><br><span class="line">    INDEX index_name (title(length))</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">–- 删除索引</span><br><span class="line">DROP INDEX index_name ON table</span><br></pre></td></tr></table></figure>
<h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p>与普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值（注意和主键不同）。如果是组合索引，则列值的组合必须唯一，创建方法和普通索引类似。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">–- 创建唯一索引</span><br><span class="line">CREATE UNIQUE INDEX indexName ON table(column(length))</span><br><span class="line"></span><br><span class="line">–- 修改表结构</span><br><span class="line">ALTER TABLE table_name ADD UNIQUE indexName ON (column(length))</span><br><span class="line"></span><br><span class="line">–- 创建表的时候直接指定</span><br><span class="line">CREATE TABLE `table` (</span><br><span class="line">    `id` int(11) NOT NULL AUTO_INCREMENT ,</span><br><span class="line">    `title` char(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,</span><br><span class="line">    `content` text CHARACTER SET utf8 COLLATE utf8_general_ci NULL ,</span><br><span class="line">    `time` int(10) NULL DEFAULT NULL ,</span><br><span class="line">    PRIMARY KEY (`id`),</span><br><span class="line">    UNIQUE indexName (title(length))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h3><p>MySQL从3.23.23版开始支持全文索引和全文检索，FULLTEXT索引仅可用于 MyISAM 表；他们可以从CHAR、VARCHAR或TEXT列中作为CREATE TABLE语句的一部分被创建，或是随后使用ALTER TABLE 或CREATE INDEX被添加。////对于较大的数据集，将你的资料输入一个没有FULLTEXT索引的表中，然后创建索引，其速度比把资料输入现有FULLTEXT索引的速度更为快。不过切记对于大容量的数据表，生成全文索引是一个非常消耗时间非常消耗硬盘空间的做法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">–- 修改表结构添加全文索引</span><br><span class="line">ALTER TABLE article ADD FULLTEXT index_content(content)</span><br><span class="line"></span><br><span class="line">–- 直接创建索引</span><br><span class="line">CREATE FULLTEXT INDEX index_content ON article(content)</span><br><span class="line"></span><br><span class="line">–- 创建表的时候直接指定</span><br><span class="line">CREATE TABLE `table` (</span><br><span class="line">    `id` int(11) NOT NULL AUTO_INCREMENT ,</span><br><span class="line">    `title` char(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,</span><br><span class="line">    `content` text CHARACTER SET utf8 COLLATE utf8_general_ci NULL ,</span><br><span class="line">    `time` int(10) NULL DEFAULT NULL ,</span><br><span class="line">    PRIMARY KEY (`id`),</span><br><span class="line">    FULLTEXT (content)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h3 id="单列索引、多列索引"><a href="#单列索引、多列索引" class="headerlink" title="单列索引、多列索引"></a>单列索引、多列索引</h3><p>多个单列索引与单个多列索引的查询效果不同，因为执行查询时，MySQL只能使用一个索引，会从多个索引中选择一个限制最为严格的索引。</p>
<h3 id="组合索引-最左前缀"><a href="#组合索引-最左前缀" class="headerlink" title="组合索引(最左前缀)"></a>组合索引(最左前缀)</h3><p>多个单列索引与单个多列索引的查询效果不同，因为执行查询时，MySQL只能使用一个索引，会从多个索引中选择一个限制最为严格的索引。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- 建立的索引</span><br><span class="line">ALTER TABLE `article` ADD INDEX `index_titme_time` (`title`(50), `time`(10));</span><br><span class="line"></span><br><span class="line">-- 使用上面索引</span><br><span class="line">SELECT * FROM `article` WHREE `title` = &apos;测试&apos; AND `time` = 1234567890;</span><br><span class="line">SELECT * FROM `article` WHREE `title` = &apos;测试&apos;;</span><br><span class="line"></span><br><span class="line">-- 没有使用索引</span><br><span class="line">SELECT * FROM `article` WHREE `time` = 1234567890;</span><br></pre></td></tr></table></figure></p>
<h4 id="创建原则"><a href="#创建原则" class="headerlink" title="创建原则"></a>创建原则</h4><ul>
<li>选择唯一性索引</li>
<li>为经常需要排序、分组和联合操作的字段建立索引</li>
<li>为常作为查询条件的字段建立索引</li>
<li>限制索引的数目</li>
<li>尽量使用数据量少的索引</li>
<li>尽量使用前缀来索引</li>
<li>删除不再使用或者很少使用的索引</li>
<li>最左前缀匹配原则，非常重要的原则</li>
<li>尽量选择区分度高的列作为索引</li>
<li>索引列不能参与计算，保持列“干净”</li>
<li>尽量的扩展索引，不要新建索引</li>
</ul>
<h4 id="索引优化"><a href="#索引优化" class="headerlink" title="索引优化"></a>索引优化</h4><p>MySQL只对一下操作符才使用索引：&lt;,&lt;=,=,&gt;,&gt;=,between,in,以及某些时候的like(不以通配符%或_开头的情形)</p>
<h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><h4 id="索引问题"><a href="#索引问题" class="headerlink" title="索引问题"></a>索引问题</h4><ul>
<li>避免对索引字符进行计算</li>
<li>避免在索引字段上面使用not,&lt;&gt;,!=</li>
<li>避免在索引字段列上使用IS NULL 和 IS NOT NULL</li>
<li>避免在索引字段列上出现数据类型转换</li>
<li>避免在索引字段上使用函数</li>
<li>避免建立的索引列中存在空值</li>
</ul>
<h4 id="前导模糊查询不能使用索引"><a href="#前导模糊查询不能使用索引" class="headerlink" title="前导模糊查询不能使用索引"></a>前导模糊查询不能使用索引</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 没有使用索引</span><br><span class="line">SELECT * FROM `order` WHERE `desc` LIKE &apos;%abc&apos;</span><br><span class="line"></span><br><span class="line">-- 使用索引</span><br><span class="line">SELECT * FROM `order` WHERE `desc` LIKE &apos;abc%&apos;</span><br></pre></td></tr></table></figure>
<h4 id="明确知道只有一条数据-limit-1-可以提高效率"><a href="#明确知道只有一条数据-limit-1-可以提高效率" class="headerlink" title="明确知道只有一条数据,limit 1 可以提高效率"></a>明确知道只有一条数据,limit 1 可以提高效率</h4><h4 id="不用使用SELECT-而是指定查询字段"><a href="#不用使用SELECT-而是指定查询字段" class="headerlink" title="不用使用SELECT * 而是指定查询字段"></a>不用使用SELECT * 而是指定查询字段</h4><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="nginx-php-fpm-出现502问题排查"><a href="#nginx-php-fpm-出现502问题排查" class="headerlink" title="nginx + php-fpm 出现502问题排查"></a>nginx + php-fpm 出现502问题排查</h2><p>nginx出现502有很多原因，但大部分原因可以归结为资源数量不够用,也就是说后端php-fpm处理有问题，nginx将正确的客户端请求发给了后端的php-fpm进程，但是因为php-fpm进程的问题导致不能正确解析php代码，最终返回给了客户端502错误。</p>
<h4 id="php-fpm-进程数不够用"><a href="#php-fpm-进程数不够用" class="headerlink" title="php-fpm 进程数不够用"></a>php-fpm 进程数不够用</h4><p>使用 netstat -napo |grep “php-fpm” | wc -l 查看一下当前fastcgi进程个数，如果个数接近conf里配置的上限，就需要调高进程数。<br>但也不能无休止调高，可以根据服务器内存情况，可以把php-fpm子进程数调到100或以上，在4G内存的服务器上200就可以</p>
<h4 id="调高调高linux内核打开文件数量"><a href="#调高调高linux内核打开文件数量" class="headerlink" title="调高调高linux内核打开文件数量"></a>调高调高linux内核打开文件数量</h4><p>可以使用这些命令(必须是root帐号)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;ulimit -HSn 65536&apos; &gt;&gt; /etc/profile</span><br><span class="line">echo &apos;ulimit -HSn 65536&apos; &gt;&gt; /etc/rc.local</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<h4 id="脚本执行时间超时"><a href="#脚本执行时间超时" class="headerlink" title="脚本执行时间超时"></a>脚本执行时间超时</h4><p>如果脚本因为某种原因长时间等待不返回 ，导致新来的请求不能得到处理，可以适当调小如下配置。</p>
<ul>
<li><p>nginx.conf里面主要是如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastcgi_connect_timeout 300;</span><br><span class="line">fastcgi_send_timeout 300;</span><br><span class="line">fastcgi_read_timeout 300;</span><br></pre></td></tr></table></figure>
</li>
<li><p>php-fpm.conf里如要是如下</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request_terminate_timeout = 10s</span><br></pre></td></tr></table></figure>
<h4 id="缓存设置比较小"><a href="#缓存设置比较小" class="headerlink" title="缓存设置比较小"></a>缓存设置比较小</h4><p>修改或增加配置到nginx.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_buffer_size 64k;</span><br><span class="line">proxy_buffers  512k;</span><br><span class="line">proxy_busy_buffers_size 128k;</span><br></pre></td></tr></table></figure>
<p>这部分参见: <a href="http://www.nginx.cn/102.html" target="_blank" rel="noopener">http://www.nginx.cn/102.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/09/php-basis2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/09/php-basis2/" class="post-title-link" itemprop="url">PHP面试-基础二</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-09 18:32:26" itemprop="dateCreated datePublished" datetime="2019-05-09T18:32:26+08:00">2019-05-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="#基础数据类型">PHP基础数据类型</a></li>
<li><a href="#预定义变量">PHP预定义变量</a></li>
<li><a href="#魔术函数">PHP魔术函数</a></li>
<li><a href="#魔术常量">PHP魔术常量</a></li>
<li><a href="#魔术常量">COOKE和SESSION</a></li>
<li><a href="#设计模式">PHP设计模式</a></li>
<li><a href="#排序算法">PHP实现排序算法</a></li>
<li><a href="https://psr.phphub.org/" target="_blank" rel="noopener">PHP编码规范PSR</a></li>
</ol>
<h1 id="基础数据类型"><a href="#基础数据类型" class="headerlink" title="基础数据类型"></a>基础数据类型</h1><p>  ● 四种标量类型</p>
<ol>
<li><a href="https://secure.php.net/manual/zh/language.types.boolean.php" target="_blank" rel="noopener">Boolean</a>     布尔类型;判断方法 is_bool(); 类型强转(bool),(boolean)</li>
<li><a href="https://secure.php.net/manual/zh/language.types.integer.php" target="_blank" rel="noopener">Integer</a>     整型;判断方法is_integer();类型强转(int),(integer)</li>
<li><a href="https://secure.php.net/manual/zh/language.types.float.php" target="_blank" rel="noopener">Float</a>         浮点型，也称作 Double；判断方法is_float();类型强转(float),(double),(real)</li>
<li><p><a href="https://secure.php.net/manual/zh/language.types.string.php" target="_blank" rel="noopener">String</a>         字符型；判断方法is_string();类型强转(string)</p>
<p>● 两种复合类型</p>
</li>
<li><a href="https://secure.php.net/manual/zh/language.types.array.php" target="_blank" rel="noopener">Array</a>         数组;判断方法is_array();类型强转(array)</li>
<li><a href="https://secure.php.net/manual/zh/language.types.object.php" target="_blank" rel="noopener">Object</a>        对象    ;判断方法is_object();类型强转(object)</li>
</ol>
<p>● 两种特殊类型</p>
<ol>
<li><a href="https://secure.php.net/manual/zh/language.types.resource.php" target="_blank" rel="noopener">Resource</a>     资源;判断方法is_resource()</li>
<li><a href="https://secure.php.net/manual/zh/language.types.null.php" target="_blank" rel="noopener">NULL</a>         NULL;判断方法 is_null();类型强转(unset)</li>
</ol>
<p>● 伪类型</p>
<p>   伪类型（pseudo-types） 是 PHP 文档里用于指示参数可以使用的类型和值。 请注意，它们不是 PHP 语言里原生类型。 所以不能把伪类型用于自定义函数里的类型约束（typehint）。</p>
<ol>
<li><a href="https://secure.php.net/manual/zh/language.pseudo-types.php#language.types.mixed" target="_blank" rel="noopener">mixed</a></li>
<li><a href="https://secure.php.net/manual/zh/language.pseudo-types.php#language.types.number" target="_blank" rel="noopener">number</a></li>
<li><a href="https://secure.php.net/manual/zh/language.pseudo-types.php#language.types.callback" target="_blank" rel="noopener">callback</a></li>
</ol>
<ul>
<li>补充说明：</li>
</ul>
<ol>
<li>通过gettype()获取变量的类型字符串</li>
<li><p>字符串单引号和双引号的区别</p>
<ul>
<li>转义字符不同     </li>
<li>对变量的解析不同(双引号解析变量)</li>
<li>解析速度不同(单引号快)</li>
</ul>
</li>
</ol>
<h1 id="预定义变量"><a href="#预定义变量" class="headerlink" title="预定义变量"></a>预定义变量</h1><ul>
<li><a href="https://secure.php.net/manual/zh/reserved.variables.globals.php" target="_blank" rel="noopener">$GLOBALS</a>  引用全局作用域中可用的全部变量</li>
<li><a href="https://secure.php.net/manual/zh/reserved.variables.server.php" target="_blank" rel="noopener">$_SERVER</a>  这种超全局变量保存关于报头、路径和脚本位置的信息。</li>
<li><a href="https://secure.php.net/manual/zh/reserved.variables.request.php" target="_blank" rel="noopener">$_REQUEST</a>     HTTP Request 变量(默认情况下包含了 $_GET，$_POST 和 $_COOKIE 的数组。)</li>
<li><a href="https://secure.php.net/manual/zh/reserved.variables.get.php" target="_blank" rel="noopener">$_GET</a>     通过 URL 参数传递给当前脚本的变量的数组。 </li>
<li><a href="https://secure.php.net/manual/zh/reserved.variables.post.php" target="_blank" rel="noopener">$_POST</a>    当 HTTP POST 请求的 Content-Type 是 application/x-www-form-urlencoded 或 multipart/form-data 时，会将变量以关联数组形式传入当前脚本</li>
<li><a href="https://secure.php.net/manual/zh/reserved.variables.files.php" target="_blank" rel="noopener">$_FILES</a>       通过 HTTP POST 方式上传到当前脚本的项目的数组</li>
<li><a href="https://secure.php.net/manual/zh/reserved.variables.environment.php" target="_blank" rel="noopener">$_ENV</a>         通过环境方式传递给当前脚本的变量的数组。</li>
<li><a href="https://secure.php.net/manual/zh/reserved.variables.cookies.php" target="_blank" rel="noopener">$_COOKIE</a>      通过 HTTP Cookies 方式传递给当前脚本的变量的数组。</li>
<li><a href="https://secure.php.net/manual/zh/reserved.variables.session.php" target="_blank" rel="noopener">$_SESSION</a>     当前脚本可用 SESSION 变量的数组。</li>
<li>补充说明$_GET和$_POST区别</li>
</ul>
<ol>
<li>GET使用URL或Cookie传参。而POST将数据放在BODY中。</li>
<li>GET的URL会有长度上的限制，则POST的数据则可以非常大。</li>
<li>POST比GET安全，因为数据在地址栏上不可见。</li>
</ol>
<h1 id="魔术函数"><a href="#魔术函数" class="headerlink" title="魔术函数"></a>魔术函数</h1><ul>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.decon.php#object.construct" target="_blank" rel="noopener">__construct()</a> </p>
<p>  PHP 5 允行开发者在一个类中定义一个方法作为构造函数。具有构造函数的类会在每次创建新对象时先调用此方法，所以非常适合在使用对象之前做一些初始化工作。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.decon.php#object.destruct" target="_blank" rel="noopener">__destruct()</a></p>
<p>  PHP 5 引入了析构函数的概念，这类似于其它面向对象的语言，如 C++。析构函数会在到某个对象的所有引用都被删除或者当对象被显式销毁时执行。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.overloading.php#object.call" target="_blank" rel="noopener">__call()</a></p>
<p>  在对象中调用一个不可访问方法时，__call() 会被调用。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.overloading.php#object.callstatic" target="_blank" rel="noopener">__callStatic()</a></p>
<p>  在静态上下文中调用一个不可访问方法时，__callStatic() 会被调用。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.overloading.php#object.get" target="_blank" rel="noopener">__get()</a></p>
<p>  读取不可访问属性的值时，__get() 会被调用。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.overloading.php#object.set" target="_blank" rel="noopener">__set()</a> </p>
<p>  在给不可访问属性赋值时，__set() 会被调用。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.overloading.php#object.isset" target="_blank" rel="noopener">__isset()</a></p>
<p>  当对不可访问属性调用 isset() 或 empty() 时，__isset() 会被调用</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.overloading.php#object.unset" target="_blank" rel="noopener">__unset()</a></p>
<p>  当对不可访问属性调用 unset() 时，__unset() 会被调用。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.magic.php#object.sleep" target="_blank" rel="noopener">__sleep()</a></p>
<p>  serialize() 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，该方法会先被调用，然后才执行序列化操作。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.magic.php#object.wakeup" target="_blank" rel="noopener">__wakeup()</a></p>
<p>  与之相反，unserialize() 会检查是否存在一个 <strong>wakeup() 方法。如果存在，则会先调用 </strong>wakeup 方法，预先准备对象需要的资源。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.magic.php#object.tostring" target="_blank" rel="noopener">__toString()</a></p>
<p>  __toString() 方法用于一个类被当成字符串时应怎样回应。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.magic.php#object.invoke" target="_blank" rel="noopener">__invoke()</a></p>
<p>  当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.magic.php#object.set-state" target="_blank" rel="noopener">__set_state()</a></p>
<p>  PHP 5.1.0 起当调用 var_export() 导出类时，此静态 方法会被调用。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.cloning.php#object.clone" target="_blank" rel="noopener">__clone()</a></p>
<p>  当复制完成时，如果定义了 <strong>clone() 方法，则新创建的对象（复制生成的对象）中的 </strong>clone() 方法会被调用，可用于修改属性的值（如果有必要的话）。    </p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/language.oop5.magic.php#object.debuginfo" target="_blank" rel="noopener">__debugInfo()</a></p>
<p>  当转储对象以获取应显示的属性时，此方法由var_dump（）调用。 如果方法未在对象上定义，那么将显示所有public，protected和private属性。</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/function.autoload.php" target="_blank" rel="noopener">__autoload</a></p>
<p>  尝试加载未定义的类(该方法在PHP7.2中已经删除)</p>
</li>
</ul>
<h1 id="魔术常量"><a href="#魔术常量" class="headerlink" title="魔术常量"></a>魔术常量</h1><ul>
<li><a href="#魔术常量">__LINE__</a> 当前文件中的行号</li>
<li><a href="#魔术常量">__FILE__</a> 返回文件的完整路径和文件名。如果用在包含文件中，则返回包含文件名。自 PHP 4.0.2 起，<strong>FILE</strong> 总是包含一个绝对路径，而在此之前的版本有时会包含一个相对路径。</li>
<li><a href="#魔术常量">__FUNCTION__</a> 返回文件的完整路径和文件名。如果用在包含文件中，则返回包含文件名。自 PHP 4.0.2 起，<strong>FILE</strong> 总是包含一个绝对路径，而在此之前的版本有时会包含一个相对路径。</li>
<li><a href="#魔术常量">__CLASS__</a> 返回类的名称（PHP 4.3.0 新加）。自 PHP 5 起本常量返回该类被定义时的名字（区分大小写）。在 PHP 4 中该值总是小写字母的。</li>
<li><a href="#魔术常量">__METHOD__</a> 返回类的方法名（PHP 5.0.0 新加）。返回该方法被定义时的名字（区分大小写）</li>
</ul>
<h1 id="COOKE和SESSION"><a href="#COOKE和SESSION" class="headerlink" title="COOKE和SESSION"></a>COOKE和SESSION</h1><h4 id="COOKIE"><a href="#COOKIE" class="headerlink" title="COOKIE"></a>COOKIE</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 设置cookie</span><br><span class="line"> * @param string $name  cookie 名称</span><br><span class="line"> * @param string $value  cookie 值</span><br><span class="line"> * @param int      $expire cookie 保存时间</span><br><span class="line"> * @param string $path  cookie 有效目录</span><br><span class="line"> * @param string $domain cookie 保存域名</span><br><span class="line"> * @param bool   $secure   cookie  是否通过HTTPS协议传输</span><br><span class="line"> * @param bool   $httponly cookie 不允许客户端修改</span><br><span class="line"> */</span><br><span class="line">bool setcookie(string $name[, string $value = &apos;&apos;[, int $expire = 0[, string $path = &apos;&apos; [, string $domain = &apos;&apos; [, bool $secure = false[, bool $httponly = false ]]]]]])</span><br></pre></td></tr></table></figure>
<h4 id="SESSION"><a href="#SESSION" class="headerlink" title="SESSION"></a>SESSION</h4><ul>
<li><p>设置相关<br>1) session.save_handler = file<br>   用于读取/回写session数据的方式，默认是files<br>2) session.save_path = “/var/lib/php/session”<br>   指定保存session文件的目录，可以指定到别的目录，但是指定目录必须要有httpd守护进程属主(比如apache或www等)写权限，否则无法回存session数据<br>3) session.auto_start = 0<br>   如果启用该选项，用户的每次请求都会初始化session。我们推荐不启用该设置，最好通过session_start()显示地初始化session</p>
</li>
<li><p>相关函数</p>
</li>
</ul>
<p>session_start:                          初始 session。</p>
<p>session_destroy:                     结束 session。</p>
<p>session_unset:                        释放session内存。</p>
<p>session_name:                        存取目前 session 名称。</p>
<p>session_module_name:           存取目前 session 模块。</p>
<p>session_save_path:                 存取目前 session 路径。</p>
<p>session_id:                              存取目前 session 代号。</p>
<p>session_register:                     注册新的变量。</p>
<p>session_unregister:                 删除已注册变量。</p>
<p>session_is_registered:             检查变量是否注册。</p>
<p>session_decode:                     Session 资料解码。</p>
<p>session_encode:                     Session 资料编码。</p>
<ol>
<li>session_start()<br>  函数session_start会初始化session，也标识着session生命周期的开始。要使用session，必须初始化一个session环境。有点类似于OOP概念中调用构造函数构创建对象实例一样。<br>session初始化操作，声明一个全局数组$_SESSION，映射寄存在内存的session数据。如果session文件已经存在，并且保存有session数据，session_start()则会读取session数据，填入$_SESSION中，开始一个新的session生命周期</li>
<li>$_SESSION<br>  它是一个全局变量，类型是Array,映射了session生命周期的session数据，寄存在内存中。在session初始化的时候，从session文件中读取数据，填入该变量中。在session生命周期结束时，将$_SESSION数据写回session文件。</li>
<li>session_register()<br>  在session生命周期内，使用全局变量名称将注全局变量注册到当前session中。所谓注册，就是将变量填入$_SESSION中，值为NULL。它不会对session文件进行任何IO操作，只是影响$_SESSION变量。注意，它的正确写法是session_register(‘varname’)，而不是session_register($varname)</li>
<li>session_unregister()<br>  与session_register操作正好相反，即在session生命周期,从当前session注销指定变量。同样只影响$_SESSION，并不进行任何IO操作</li>
<li>session_unset()<br>  在session生命周期，从当前session中注销全部session数据，让$_SESSION成为一个空数组。它与unset($_SESSION)的区别在于:unset直接删除$_SESSION变量，释放内存资源;另一个区别在于，session_unset()仅在session生命周期能够操作$_SESSION数组，而unset()则在整个页面(page)生命周期都能操作$_SESSION数组。session_unset()同样不进行任何IO操作，只影响$_SESSION数组</li>
<li>session_destroy()<br>   如果说session_start()初始化一个session的话，而它则注销一个session。意味着session生命周期结束了。在session生命周期结整后，session_register, session_unset, session_register都将不能操作$_SESSION数组，而$_SESSION数组依然可以被unset()等函数操作。这时，session意味着是未定义的，而$_SESSION依然是一个全局变量，他们脱离了关映射关系。 通过session_destroy()注销session,除了结束session生命周期外，它还会删除sesion文件，但不会影响当前$_SESSION变量。即它会产生一个IO操作</li>
<li>session_regenerate_id()<br>  调用它，会给当前用户重新分配一个新的session id。并且在结束当前页面生命周期的时候，将当前session数据写入session文件。前提是，调用此函数之前，当前session生命周期没有被终止（参考第9点）。它会产生一个IO操作，创建一个新的session文件，创建新的session文件的是在session结束之前，而不是调用此函数就立即创建新的session文件。</li>
<li>session_commit()<br>  session_commit()函数是session_write_close()函数的别名。它会结束当前session的生命周期，并且将session数据立即强制写入session文件。不推荐通过session_commit()来手工写入session数据，因为PHP会在页面生命周期结束的时候，自动结束当前没有终止的session生命周期。它会产生一个IO写操作</li>
<li>session_end()<br>  结束session，默认是在页面生命周期结束的之前，PHP会自动结束当前没有终止的session。但是还可以通过session_commit()与session_destroy()二个函数提前结束session。不管是哪种方式，结束session都会产生IO操作，分别不一样。默认情况，产生一个IO写操作，将当前session数据写回session文件。session_commit()则是调用该函数那刻，产生一个IO写操作，将session数据写回session文件。而session_destroy()不一样在于，它不会将数据写回session文件，而是直接删除当前session文件。有趣的是，不管是session_commit()，还是session_destroy()都不会清空$_SESSION数组，更不会删除$<em>SESSION数组，只是所有session</em>*函数不能再操作session数据，因为当前的session生命周期终止了，即不能操作一个未定义对象。</li>
</ol>
<h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><ul>
<li>一、单例设计模式</li>
</ul>
<p>单例模式的要点有三个：</p>
<ol>
<li><p>一是某个类只能有一个实例</p>
</li>
<li><p>二是它必须自行创建这个实例</p>
</li>
<li><p>三是它必须自行向整个系统提供这个实例</p>
</li>
</ol>
<p>为什么要使用PHP单例模式</p>
<p>php的应用主要在于数据库应用, 一个应用中会存在大量的数据库操作, 在使用面向对象的方式开发时, 如果使用单例模式, 则可以避免大量的new 操作消耗的资源,还可以减少数据库连接这样就不容易出现 too many connections情况。</p>
<p>一个类来全局控制某些配置信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">namespace lib\mode;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Class Man</span><br><span class="line"> * @package lib\mode</span><br><span class="line"> * @desc 设计模式单例模式</span><br><span class="line"> * 1 私有化构造函数和克隆函数</span><br><span class="line"> * 2 提供方法实例化对象</span><br><span class="line"> */</span><br><span class="line">class Man</span><br><span class="line">&#123;</span><br><span class="line">    // 保存实例化对象属性</span><br><span class="line">    private static $instance;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Man constructor.</span><br><span class="line">     * @desc 私有化构造函数</span><br><span class="line">     */</span><br><span class="line">    private function __construct()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * __clone() 私有化克隆函数</span><br><span class="line">     */</span><br><span class="line">    private function __clone()</span><br><span class="line">    &#123;</span><br><span class="line">        return self::$instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * getInstance() 提供公共方法获取对象</span><br><span class="line">     * @return Man</span><br><span class="line">     */</span><br><span class="line">    public static function getInstance()</span><br><span class="line">    &#123;</span><br><span class="line">        if (!self::$instance) &#123;</span><br><span class="line">            self::$instance = new self();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return self::$instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 其他方法</span><br><span class="line">     */</span><br><span class="line">    public function test()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &apos;单例设计模式&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>二、简单工厂模式</li>
</ul>
<ol>
<li>抽象基类：类中定义抽象一些方法，用以在子类中实现</li>
<li><p>继承自抽象基类的子类：实现基类中的抽象方法</p>
<ul>
<li>工厂类：用以实例化所有相对应的子类</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">namespace lib\mode;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Class Factory</span><br><span class="line"> * @package lib\mode</span><br><span class="line"> * @desc 设计模式 简单工厂模式</span><br><span class="line"> * 1、提供一个工厂类，生产出指定类</span><br><span class="line"> * 2、提供一个抽象类，设计出需要抽象的方法，让子类实现</span><br><span class="line"> * 3、子类实现抽象基类</span><br><span class="line"> */</span><br><span class="line">class Factory</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * createObject() 工厂提供创建对象方法</span><br><span class="line">     * @param  string      $name    需要创建的类名</span><br><span class="line">     * @param  mixed|null  $config  配置信息</span><br><span class="line">     * @return bool</span><br><span class="line">     */</span><br><span class="line">    public static function createObject($name, $config = null)</span><br><span class="line">    &#123;</span><br><span class="line">        $mixReturn = false;</span><br><span class="line">        if ($name) &#123;</span><br><span class="line">            $name = &apos;\\lib\\mode\\&apos;.$name;</span><br><span class="line">            if(class_exists($name)) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                  $mixReturn = new $name($config);</span><br><span class="line">                &#125; catch (\Exception $e) &#123;</span><br><span class="line">                    $mixReturn = false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return $mixReturn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Class Operation</span><br><span class="line"> * @package lib\mode</span><br><span class="line"> * @desc 抽象基类， 提供抽象方法</span><br><span class="line"> */</span><br><span class="line">abstract class Operation</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * getValue() 提供抽象方法，计算两个值的操作后的值</span><br><span class="line">     * @param $value1</span><br><span class="line">     * @param $value2</span><br><span class="line">     * @return mixed</span><br><span class="line">     */</span><br><span class="line">    abstract public function getValue($value1, $value2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Class Add</span><br><span class="line"> * @package lib\mode</span><br><span class="line"> * @desc 加法类</span><br><span class="line"> */</span><br><span class="line">class Add extends Operation</span><br><span class="line">&#123;</span><br><span class="line">    public function getValue($value1, $value2)</span><br><span class="line">    &#123;</span><br><span class="line">        return $value1 + $value2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Class Subtract</span><br><span class="line"> * @package lib\mode</span><br><span class="line"> * @desc 减法类</span><br><span class="line"> */</span><br><span class="line">class Subtract extends Operation</span><br><span class="line">&#123;</span><br><span class="line">    public function getValue($value1, $value2)</span><br><span class="line">    &#123;</span><br><span class="line">        return $value1 - $value2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 使用 加法类</span><br><span class="line">$obj = Factory::createObject(&apos;Add&apos;);</span><br><span class="line">var_dump($obj-&gt;getValue(8, 13));</span><br><span class="line"></span><br><span class="line">// 使用 减法类</span><br><span class="line">$obj = Factory::createObject(&apos;Subtract&apos;);</span><br><span class="line">var_dump($obj-&gt;getValue(8, 13));</span><br></pre></td></tr></table></figure>
<ul>
<li>三、观察者模式<pre><code>定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新【GOF95】 又称为发布-订阅（Publish-Subscribe）模式、模型-视图（Model-View）模式、源-监听（Source-Listener）模式、或从属者(Dependents)模式
</code></pre></li>
</ul>
<ol>
<li><p>抽象主题（Subject）角色：主题角色将所有对观察者对象的引用保存在一个集合中，每个主题可以有任意多个观察者。 抽象主题提供了增加和删除观察者对象的接口。</p>
</li>
<li><p>抽象观察者（Observer）角色：为所有的具体观察者定义一个接口，在观察的主题发生改变时更新自己。</p>
</li>
<li><p>具体主题（ConcreteSubject）角色：存储相关状态到具体观察者对象，当具体主题的内部状态改变时，给所有登记过的观察者发出通知。具体主题角色通常用一个具体子类实现。</p>
</li>
<li><p>具体观察者（ConcretedObserver）角色：存储一个具体主题对象，存储相关状态，实现抽象观察者角色所要求的更新接口，以使得其自身状态和主题的状态保持一致</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace lib\mode;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Class Observe</span><br><span class="line"> * @package lib\mode</span><br><span class="line"> * @desc 设计模式 观察者模式</span><br><span class="line"> * 1、监听器</span><br><span class="line"> * 2、被观察者</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Class Subject</span><br><span class="line"> * @package lib\mode</span><br><span class="line"> * @desc 抽象主题角色</span><br><span class="line"> */</span><br><span class="line">class Subject implements \SplSubject</span><br><span class="line">&#123;</span><br><span class="line">    private $observers;</span><br><span class="line">    private $name;</span><br><span class="line"></span><br><span class="line">    public function __construct($name)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;observers = new \SplObjectStorage();</span><br><span class="line">        $this-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * attach() 添加一个新的观察者对象</span><br><span class="line">     * @param \SplObserver $observer</span><br><span class="line">     */</span><br><span class="line">    public function attach(\SplObserver $observer)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;observers-&gt;attach($observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * detach() 删除一个已经注册过的观察者</span><br><span class="line">     * @param \SplObserver $observer</span><br><span class="line">     */</span><br><span class="line">    public function detach(\SplObserver $observer)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;observers-&gt;detach($observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function notify()</span><br><span class="line">    &#123;</span><br><span class="line">        foreach ($this-&gt;observers as $observer) &#123;</span><br><span class="line">            $observer-&gt;update($this);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getName()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Class Observe</span><br><span class="line"> * @package lib\mode</span><br><span class="line"> * @desc 观察者角色信息类</span><br><span class="line"> */</span><br><span class="line">class Observe implements \SplObserver</span><br><span class="line">&#123;</span><br><span class="line">    public function update(\SplSubject $subject)</span><br><span class="line">    &#123;</span><br><span class="line">        var_dump(__CLASS__. &apos;-&apos; . $subject-&gt;getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Class Observe</span><br><span class="line"> * @package lib\mode</span><br><span class="line"> * @desc 观察者角色信息类1</span><br><span class="line"> */</span><br><span class="line">class Observe1 implements \SplObserver</span><br><span class="line">&#123;</span><br><span class="line">    public function update(\SplSubject $subject)</span><br><span class="line">    &#123;</span><br><span class="line">        var_dump(__CLASS__. &apos;-&apos; . $subject-&gt;getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 使用说明</span><br><span class="line">$observer1 = new Observe();</span><br><span class="line">$observer2 = new Observe1();</span><br><span class="line">$subject = new Subject(&quot;test&quot;);</span><br><span class="line"></span><br><span class="line">$subject-&gt;attach($observer1);</span><br><span class="line">$subject-&gt;attach($observer2);</span><br><span class="line"></span><br><span class="line">$subject-&gt;notify();</span><br></pre></td></tr></table></figure>
<h1 id="排序算法"><a href="#排序算法" class="headerlink" title="排序算法"></a>排序算法</h1><ul>
<li><p>冒泡排序</p>
<p>  思路分析：在要排序的一组数中，对当前还未排好的序列，从前往后对相邻的两个数依次进行比较和调整，让较大的数往下沉，较小的往上冒。即，每当两相邻的数比较后发现它们的排序与排序要求相反时，就将它们互换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 冒泡排序</span><br><span class="line"> * @param array $array</span><br><span class="line"> * @return array</span><br><span class="line"> */</span><br><span class="line">function bubbleSort($array)</span><br><span class="line">&#123;</span><br><span class="line">    $length = count($array);</span><br><span class="line">    if ($length &gt; 1) &#123;</span><br><span class="line">        for ($i = 0; $i &lt; $length; $i++) &#123;</span><br><span class="line">            for ($x = 0; $x &lt; ($length - $i - 1); $x++) &#123;</span><br><span class="line">                if ($array[$x] &gt; $array[$x + 1]) &#123;</span><br><span class="line">                    $tmp = $array[$x + 1];</span><br><span class="line">                    $array[$x + 1] = $array[$x];</span><br><span class="line">                    $array[$x] = $tmp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>快速排序</p>
<p>  找到当前数组中的任意一个元素（一般选择第一个元素），作为标准，新建两个空数组，遍历整个数组元素，<br>如果遍历到的元素比当前的元素要小，那么就放到左边的数组，否则放到右面的数组，然后再对新数组进行同样的操作，<br>不难发现，这里符合递归的原理，所以我们可以用递归来实现。</p>
</li>
</ul>
<p>使用递归，则需要找到递归点和递归出口：<br>递归点：如果数组的元素大于1，就需要再进行分解，所以我们的递归点就是新构造的数组元素个数大于1</p>
<p>递归出口：我们什么时候不需要再对新数组不进行排序了呢？就是当数组元素个数变成1的时候，所以这就是我们的出口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 快速排序</span><br><span class="line"> * @param array $array</span><br><span class="line"> * @return array</span><br><span class="line"> */</span><br><span class="line">function quickSort(array $array)</span><br><span class="line">&#123;</span><br><span class="line">    if ($array &amp;&amp; is_array($array)) &#123;</span><br><span class="line">        $length = count($array);</span><br><span class="line">        if ($length &gt; 1) &#123;</span><br><span class="line">            $left = $right = [];</span><br><span class="line">            for ($i = 1; $i &lt; $length; $i ++) &#123;</span><br><span class="line">                // 判断当前元素的大小和第一个元素比较</span><br><span class="line">                if ($array[$i] &lt; $array[0]) &#123;</span><br><span class="line">                    $left[] = $array[$i];</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    $right[] = $array[$i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // 递归调用</span><br><span class="line">            if ($left) &#123;</span><br><span class="line">                $left = quickSort($left);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if ($right) &#123;</span><br><span class="line">                $right = quickSort($right);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return array_merge($left, [$array[0]], $right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>选择排序</p>
<p>  思路分析：在要排序的一组数中，选出最小的一个数与第一个位置的数交换。然后在剩下的数当中再找最小的与第二个位置的数交换，如此循环到倒数第二个数和最后一个数比较为止。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 选择排序</span><br><span class="line"> * 在要排序的一组数中，选出最小的一个数与第一个位置的数交换。然后在剩下的数当中再找最小的与第二个位置的数交换，如此循环到倒数第二个数和最后一个数比较为止。</span><br><span class="line"> * @param array $array</span><br><span class="line"> * @return array</span><br><span class="line"> */</span><br><span class="line">function selectSort(array $array)</span><br><span class="line">&#123;</span><br><span class="line">    $length = count($array);</span><br><span class="line">    if ($length &gt; 1) &#123;</span><br><span class="line"></span><br><span class="line">        for ($i = 0; $i &lt; $length - 1; $i ++) &#123;</span><br><span class="line">            $index = $i;</span><br><span class="line">            for ($x = $i + 1; $x &lt; $length; $x ++) &#123;</span><br><span class="line">                // 默认$array[$index] 为最小值</span><br><span class="line">                if ($array[$index] &gt; $array[$x]) &#123;</span><br><span class="line">                    // 记录最小值</span><br><span class="line">                    $index = $x;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // 已经确定最小值的位置，保持到$index中;如果发现最小值的位置与当前假设的位置$i不同，则位置互换即可。</span><br><span class="line">            if ($index != $i) &#123;</span><br><span class="line">                $tmp = $array[$index];</span><br><span class="line">                $array[$index] = $array[$i];</span><br><span class="line">                $array[$i] = $tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>插入排序</p>
<p>  在要排序的一组数中，假设前面的数已经是排好顺序的，现在要把第n个数插到前面的有序数中，使得这n个数也是排好顺序的。如此反复循环，直到全部排好顺序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 插入排序</span><br><span class="line"> * 在要排序的一组数中，假设前面的数已经是排好顺序的，现在要把第n个数插到前面的有序数中，使得这n个数也是排好顺序的。如此反复循环，直到全部排好顺序。</span><br><span class="line"> * @param array $array</span><br><span class="line"> * @return array</span><br><span class="line"> */</span><br><span class="line">function insertSort(array $array)</span><br><span class="line">&#123;</span><br><span class="line">    $length = count($array);</span><br><span class="line">    if ($length &gt; 0) &#123;</span><br><span class="line">        for ($i = 1; $i &lt; $length; $i ++) &#123;</span><br><span class="line">            $tmp = $array[$i];</span><br><span class="line"></span><br><span class="line">            // 内层循环，比较插入</span><br><span class="line">            for ($x = $i - 1; $x &gt;= 0; $x --) &#123;</span><br><span class="line">                if ($tmp &lt; $array[$x]) &#123;</span><br><span class="line">                    // 发现插入的元素要小，交换位置，将后边的元素与前面的元素互换</span><br><span class="line">                    $array[$x + 1] = $array[$x];</span><br><span class="line">                    $array[$x] = $tmp;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/09/php-basis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/09/php-basis/" class="post-title-link" itemprop="url">PHP面试-基础一</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-09 18:24:35" itemprop="dateCreated datePublished" datetime="2019-05-09T18:24:35+08:00">2019-05-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><strong>PHP中数组 + 和 array_merge 区别</strong></li>
</ul>
<ol>
<li><p>当键名为数字时，array_merge不会覆盖原来的值，+会抛弃后面的值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$array1 = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">$array2 = [<span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">var_dump($array1 + $array2); <span class="comment">// [1, 2]</span></span><br><span class="line">var_dump(array_merge($array1, $array2)); <span class="comment">// [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>当键名为字符串时，+ 会舍弃掉后面键相同的元素，array_merge键相同的后面元素覆盖前面元素</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$array1 = [<span class="string">'user'</span> =&gt; <span class="number">1</span>, <span class="string">'name'</span> =&gt; <span class="number">2</span>];</span><br><span class="line">$array2 = [<span class="string">'user'</span> =&gt; <span class="number">3</span>, <span class="string">'name'</span> =&gt; <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">var_dump($array1 + $array2); <span class="comment">// ['user' =&gt; 1, 'name' =&gt; 2]</span></span><br><span class="line">var_dump(array_merge($array1, $array2)); <span class="comment">// ['user' =&gt; 3, 'name' =&gt; 4]</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><strong>GET和POST的区别？</strong></li>
</ul>
<ol>
<li>GET在浏览器回退时是无害的，而POST会再次提交请求。</li>
<li>GET产生的URL地址可以被Bookmark，而POST不可以。</li>
<li>GET请求会被浏览器主动cache，而POST不会，除非手动设置。</li>
<li>GET请求只能进行url编码，而POST支持多种编码方式。</li>
<li>GET请求参数会被完整保留在浏览器历史记录里，而POST中的参数不会被保留。</li>
<li>GET请求在URL中传送的参数是有长度限制的，而POST没有。</li>
<li>对参数的数据类型，GET只接受ASCII字符，而POST没有限制。</li>
<li>GET比POST更不安全，因为参数直接暴露在URL上，所以不能用来传递敏感信息。</li>
<li>GET参数通过URL传递，POST放在Request body中。</li>
<li>GET产生一个TCP数据包，POST产生两个TCP数据包。</li>
</ol>
<ul>
<li><strong>COOKIE和SESSION的区别？</strong></li>
</ul>
<ol>
<li>COOKIE保存在客户端，而SESSION则保存在服务器端</li>
<li>从安全性来讲，SESSION的安全性更高</li>
<li>从保存内容的类型的角度来讲，COOKIE只保存字符串（及能够自动转换成字符串）</li>
<li>从保存内容的大小来看，COOKIE保存的内容是有限的，比较小，而SESSION基本上没有这个限制</li>
<li>从性能的角度来讲，用SESSION的话，对服务器的压力会更大一些<br>SEEION依赖于COOKIE，但如果禁用COOKIE，也可以通过url传递</li>
</ol>
<ul>
<li><strong>单引号和双引号的区别？</strong></li>
</ul>
<ol>
<li>单引号不解析特殊字符，双引号能够解析变量和特殊字符串</li>
<li>单引号的速度大于双引号</li>
</ol>
<ul>
<li><strong>isset 和 empty 的区别？</strong></li>
</ul>
<ol>
<li>isset 判断变量是否已经定义，empty 判断一个变量是否为空</li>
<li>当变量为空、空字符、0, isset 和 empty 返回都为 true</li>
<li>当变量未定义、或者变量为null, isset 返回 false, empty 返回ture</li>
</ol>
<ul>
<li><strong>echo、print、print_r、var_dump 的区别？</strong></li>
</ul>
<ol>
<li>echo: 可以一次输出多个值，多个值之间用逗号分隔。echo是语言结构(language construct)，而并不是真正的函数，因此不能作为表达式的一部分使用。</li>
<li>print: 函数print()打印一个值（它的参数），如果字符串成功显示则返回true，否则返回false。</li>
<li>print_r: 可以把字符串和数字简单地打印出来，而数组则以括起来的键和值得列表形式显示，并以Array开头。但print_r()输出布尔值和NULL的结果没有意义，因为都是打印”\n”。因此用var_dump()函数更适合调试。</li>
<li>var_dump: 判断一个变量的类型与长度,并输出变量的数值,如果变量有值输的是变量的值并回返数据类型。此函数显示关于一个或多个表达式的结构信息，包括表达式的类型与值。数组将递归展开值，通过缩进显示其结构。</li>
</ol>
<ul>
<li><strong>什么是MVC？</strong></li>
</ul>
<blockquote>
<p>MVC是一种软件架构的思想，将软件按照模型、视图、控制器<br>来划分。模型负责封装业务处理逻辑，视图负责输入和输出(<br>表示逻辑)，控制器负责协调模型和视图。</p>
</blockquote>
<blockquote>
<ul>
<li>Model 模型：</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<p>需要先写接口,然后实现接口中声明的方法。<br>业务处理逻辑：业务本身的处理流程，另外，还包括<br>为保证业务处理正常可靠执行的基础服务(事务、安全、<br>日志等等)。</p>
</blockquote>
</blockquote>
<blockquote>
<ul>
<li>View 视图:</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<p>输入：提供相应的操作界面，方便用户使用。<br>输出：将模型返回的结果以合适的方式来展现。</p>
<ul>
<li>Controller 控制器:</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>协调: 视图向控制器发请求，由控制器来选择相应的<br>模型来处理；模型返回的结果给控制器，由控制器来<br>选择合适的视图，生成相应的界面给用户。</p>
</blockquote>
</blockquote>
<ul>
<li><strong>传值和传引用的区别？</strong></li>
</ul>
<ol>
<li>按值传递：函数内对值的任何改变在函数外部都会被忽略。</li>
<li>引用传递：函数内对值的任何改变在函数外部也能反映出这些修改。</li>
<li>应用场景：按值传递时，php必须复制值，而按引用传递则不需要复制值，故引用传递一般用于大字符串或对象。</li>
</ol>
<h3 id="进阶篇"><a href="#进阶篇" class="headerlink" title="进阶篇"></a>进阶篇</h3><ul>
<li>简述 S.O.L.I.D 设计原则</li>
</ul>
<table>
<thead>
<tr>
<th>-</th>
<th>-</th>
<th>-</th>
</tr>
</thead>
<tbody>
<tr>
<td>SRP</td>
<td>单一职责原则</td>
<td>一个类有且只有一个更改的原因</td>
</tr>
<tr>
<td>OCP</td>
<td>开闭原则</td>
<td>能够不更改类而扩展类的行为</td>
</tr>
<tr>
<td>LSP</td>
<td>里氏替换原则</td>
<td>派生类可以替换基类使用</td>
</tr>
<tr>
<td>ISP</td>
<td>接口隔离原则</td>
<td>使用客户端特定的细粒度接口</td>
</tr>
<tr>
<td>DIP</td>
<td>依赖反转原则</td>
<td>依赖抽象而不是具体实现</td>
</tr>
</tbody>
</table>
<ul>
<li>PHP7 和 PHP5 的区别，具体多了哪些新特性？</li>
</ul>
<blockquote>
<ol>
<li>性能提升了两倍</li>
<li>增加了结合比较运算符 (&lt;=&gt;)</li>
<li>增加了标量类型声明、返回类型声明</li>
<li><code>try...catch</code> 增加多条件判断，更多 Error 错误可以进行异常处理</li>
<li>增加了匿名类，现在支持通过new class 来实例化一个匿名类，这可以用来替代一些“用后即焚”的完整类定义</li>
</ol>
</blockquote>
<ul>
<li>为什么 PHP7 比 PHP5 性能提升了？</li>
</ul>
<blockquote>
<ol>
<li>变量存储字节减小，减少内存占用，提升变量操作速度</li>
<li>改善数组结构，数组元素和 hash 映射表被分配在同一块内存里，降低了内存占用、提升了 cpu 缓存命中率</li>
<li>改进了函数的调用机制，通过优化参数传递的环节，减少了一些指令，提高执行效率</li>
</ol>
</blockquote>
<ul>
<li>简述一下 PHP 垃圾回收机制（GC）</li>
</ul>
<blockquote>
<p>PHP 5.3 版本之前都是采用引用计数的方式管理内存，PHP 所有的变量存在一个叫 <code>zval</code> 的变量容器中，当变量被引用的时候，引用计数会+1，变量引用计数变为0时，PHP 将在内存中销毁这个变量。</p>
<p>但是引用计数中的循环引用，引用计数不会消减为 0，就会导致内存泄露。</p>
<p>在 5.3 版本之后，做了这些优化：</p>
<ol>
<li>并不是每次引用计数减少时都进入回收周期，只有根缓冲区满额后在开始垃圾回收；</li>
<li>可以解决循环引用问题；</li>
<li>可以总将内存泄露保持在一个阈值以下。</li>
</ol>
</blockquote>
<p>了解更多可以查看 PHP 手册，<a href="http://docs.php.net/manual/zh/features.gc.performance-considerations.php" target="_blank" rel="noopener">垃圾回收机制</a>。</p>
<ul>
<li>如何解决 PHP 内存溢出问题</li>
</ul>
<blockquote>
<ol>
<li>增大 PHP 脚本的内存分配</li>
<li>变量引用之后及时销毁</li>
<li>将数据分批处理</li>
</ol>
</blockquote>
<ul>
<li>Redis、Memecached 这两者有什么区别？</li>
</ul>
<blockquote>
<ol>
<li>Redis 支持更加丰富的数据存储类型，String、Hash、List、Set 和 Sorted Set。Memcached 仅支持简单的 key-value 结构。</li>
<li>Memcached key-value存储比 Redis 采用 hash 结构来做 key-value 存储的内存利用率更高。</li>
<li>Redis 提供了事务的功能，可以保证一系列命令的原子性</li>
<li>Redis 支持数据的持久化，可以将内存中的数据保持在磁盘中</li>
<li>Redis 只使用单核，而 Memcached 可以使用多核，所以平均每一个核上 Redis 在存储小数据时比 Memcached 性能更高。</li>
</ol>
</blockquote>
<ul>
<li>Redis 如何实现持久化？</li>
</ul>
<blockquote>
<ol>
<li>RDB 持久化，将 Redis 在内存中的的状态保存到硬盘中，相当于备份数据库状态。</li>
<li>AOF 持久化（Append-Only-File），AOF 持久化是通过保存 Redis 服务器锁执行的写状态来记录数据库的。相当于备份数据库接收到的命令，所有被写入 AOF 的命令都是以 Redis 的协议格式来保存的。</li>
</ol>
</blockquote>
<h3 id="Web-安全防范"><a href="#Web-安全防范" class="headerlink" title="Web 安全防范"></a>Web 安全防范</h3><ul>
<li>CSRF 是什么？如何防范？</li>
</ul>
<blockquote>
<p>CSRF（Cross-site request forgery）通常被叫做「跨站请求伪造」，可以这么理解：攻击者盗用用户身份，从而欺骗服务器，来完成攻击请求。</p>
</blockquote>
<p>防范措施：</p>
<ol>
<li>使用验证码</li>
<li>给每一个请求添加令牌 token 并验证</li>
</ol>
<ul>
<li>XSS 是什么？如何防范？</li>
</ul>
<blockquote>
<p>XSS(Cross Site Scripting)，跨站脚本攻击，攻击者往 Web 页面里插入恶意 Script 代码，当用户浏览该页之时，嵌入其中 Web 里面的 Script 代码会被执行，从而达到恶意攻击用户的目的。</p>
</blockquote>
<p>防止 XSS 攻击的方式有很多，其核心的本质是：永远不要相信用户的输入数据，始终保持对用户数据的过滤。</p>
<ul>
<li>什么是 SQL 注入？如何防范？</li>
</ul>
<blockquote>
<p>SQL 注入就是攻击者通过一些方式欺骗服务器，结果执行了一些不该被执行的 SQL。</p>
</blockquote>
<p>SQL 注入的常见场景</p>
<ol>
<li>数据库里被注入了大量的垃圾数据，导致服务器运行缓慢、崩溃。</li>
<li>利用 SQL 注入暴露了应用程序的隐私数据</li>
</ol>
<p>防范措施：</p>
<ol>
<li>保持对用户数据的过滤</li>
<li>不要使用动态拼装 SQL</li>
<li>增加输入验证，比如验证码</li>
<li>对隐私数据加密，禁止明文存储</li>
</ol>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul>
<li>本文载自：<a href="https://github.com/todayqq/PHPerInterviewGuide/blob/master/php.md" target="_blank" rel="noopener">https://github.com/todayqq/PHPerInterviewGuide/blob/master/php.md</a></li>
</ul>
<h3 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h3><ul>
<li><a href="http://coffeephp.com/articles/4?utm_source=laravel-china.org" target="_blank" rel="noopener">3年PHPer的面试总结</a></li>
<li><a href="http://docs.php.net/manual/zh/features.gc.performance-considerations.php" target="_blank" rel="noopener">垃圾回收机制</a></li>
<li><a href="https://laravel-china.org/articles/4160/solid-object-oriented-design-and-programming-oodoop-notes?order_by=created_at&amp;" target="_blank" rel="noopener">S.O.L.I.D 面向对象设计</a></li>
<li><a href="http://www.cnblogs.com/DebugLZQ/archive/2013/06/05/3107957.html" target="_blank" rel="noopener">浅谈IOC–说清楚IOC是什么</a></li>
<li><a href="https://www.biaodianfu.com/redis-vs-memcached.html" target="_blank" rel="noopener">Redis和Memcached的区别</a></li>
<li><a href="https://www.cnblogs.com/phpstudy2015-6/p/6771239.html" target="_blank" rel="noopener">CSRF攻击与防御</a></li>
<li><a href="https://www.cnblogs.com/phpstudy2015-6/p/6767032.html#_label9" target="_blank" rel="noopener">XSS跨站脚本攻击</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://mylovegy.github.io/blog/blog/2019/05/09/php/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jinxing.liu@qq.com">
      <meta itemprop="description" content="刘金星个人博客">
      <meta itemprop="image" content="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘金星个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/blog/2019/05/09/php/" class="post-title-link" itemprop="url">PHP证书加密和解密</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-09 18:18:12" itemprop="dateCreated datePublished" datetime="2019-05-09T18:18:12+08:00">2019-05-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 22:32:38" itemprop="dateModified" datetime="2019-08-22T22:32:38+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="加密签名"><a href="#加密签名" class="headerlink" title="加密签名"></a>加密签名</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取签名</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $str            需要加密的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $rsaPrivateFile 私钥文件地址</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRsaSign</span><span class="params">($str, $rsaPrivateFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $privateKey = file_get_contents($rsaPrivateFile);</span><br><span class="line">    $resource   = openssl_get_privatekey($privateKey);</span><br><span class="line">    openssl_sign($str, $sign, $resource, OPENSSL_ALGO_SHA256);</span><br><span class="line">    openssl_free_key($resource);</span><br><span class="line">    <span class="keyword">return</span> base64_encode($sign);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="秘钥验证"><a href="#秘钥验证" class="headerlink" title="秘钥验证"></a>秘钥验证</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证签名</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $sign          需要验证的签名字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $str           参与加密的字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $rsaPublicFile 公钥文件地址</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkRsaSign</span><span class="params">($sign, $str, $rsaPublicFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $public_key = file_get_contents($rsaPublicFile);</span><br><span class="line">    $resource   = openssl_get_publickey($public_key);</span><br><span class="line">    $result     = (bool)openssl_verify($str, $sign, $resource, OPENSSL_ALGO_SHA256);</span><br><span class="line">    openssl_free_key($resource);</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://b337.photo.store.qq.com/psb?/V113yP6J3Q8KRH/VwlDaninBuZQcfDNwE7bzqklNPxvb3aZ7be5VebwG*I!/b/dOvB4sh*IQAA&bo=gAJVA7AEQAYBGBk!&rf=viewer_4!/both/220x220" alt="jinxing.liu@qq.com">
            
              <p class="site-author-name" itemprop="name">jinxing.liu@qq.com</p>
              <div class="site-description motion-element" itemprop="description">刘金星个人博客</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/blog/archives/">
                
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/blog/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/myloveGy" title="GitHub &rarr; https://github.com/myloveGy" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:jinxing.liu@qq.com" title="E-Mail &rarr; mailto:jinxing.liu@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jinxing.liu@qq.com</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.1.1</div>





<div>
  <div class="theme-info">
    优秀博客：
      <a href="http://blog.fifsky.com/" rel="noopener" target="_blank">fifsky的技术笔记</a>
    <span class="post-meta-divider">|</span>
    <a href="http://www.littlebug.vip/" rel="noopener" target="_blank">littlebug</a>
  </div>
</div>

        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/blog/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/blog/js/utils.js?v=7.1.1"></script>

  <script src="/blog/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/blog/js/affix.js?v=7.1.1"></script>

  <script src="/blog/js/schemes/pisces.js?v=7.1.1"></script>



  

  


  <script src="/blog/js/next-boot.js?v=7.1.1"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
